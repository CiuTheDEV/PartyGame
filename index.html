<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tajniacy</title>
<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:#1a1a1a;color:#fff;text-align:center;padding:1vh 1vw;display:flex;flex-direction:column}
body.game-active{height:100vh;height:100dvh;overflow:hidden;padding:0.5vh 0.5vw}

/* GAME SCREEN */
#gameScreen{display:none;flex-direction:column;height:100%;overflow:hidden;padding:0.5vh 1vw}
.game-header{flex-shrink:0;padding:0.5vh 0}
.game-header h1{margin:0;font-size:clamp(1.5rem,4vh,4rem)}
#gameModeLabel{font-size:clamp(0.8rem,2vh,1.5rem);color:#aaa;margin-top:0.3vh}

.main-container{display:flex;flex-grow:1;gap:1vw;margin:0 auto;width:100%;min-height:0;overflow:hidden;padding:0.5vh 0}
.side-panel{display:flex;flex-direction:column;justify-content:center;gap:0.8vh;width:8vw;min-width:50px;max-width:120px;align-items:center;flex-shrink:0}
.side-counter{font-size:clamp(1.5rem,4vh,4rem);font-weight:bold;margin-bottom:0.5vh}
.side-counter.red{color:#e74c3c}.side-counter.blue{color:#3498db}
.side-card{width:clamp(40px,5vw,100px);height:clamp(30px,5vh,70px);border-radius:clamp(4px,0.5vw,10px);display:flex;align-items:center;justify-content:center;font-size:clamp(1rem,3vh,2.5rem);transition:all .3s}
.side-card.red{background:#e74c3c}.side-card.blue{background:#3498db}
.side-card.revealed{opacity:.2;transform:scale(.8)}

.center-area{flex-grow:1;display:flex;flex-direction:column;min-width:0;min-height:0;overflow:hidden}

.scoreboard{display:flex;justify-content:center;gap:clamp(15px,3vw,60px);margin:0 auto 0.5vh;font-weight:bold;flex-shrink:0}
.score-team{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);padding:clamp(8px,1.5vh,25px) clamp(15px,2vw,50px);border-radius:clamp(8px,1vw,20px);border:clamp(2px,0.3vw,5px) solid;display:flex;align-items:center;gap:clamp(8px,1vw,20px);justify-content:space-between}
.score-team.red{border-color:#e74c3c}.score-team.blue{border-color:#3498db}
.team-info{display:flex;align-items:center;gap:clamp(5px,0.8vw,15px)}
.team-emoji{font-size:clamp(1.5rem,4vh,4rem)}
.team-name{font-size:clamp(1rem,2.5vh,2.5rem)}
.team-score{font-size:clamp(1.5rem,4vh,4rem);padding:clamp(3px,0.5vh,10px) clamp(10px,1.5vw,30px);border-radius:clamp(6px,0.8vw,15px);min-width:clamp(40px,4vw,80px);text-align:center}
.score-team.red .team-name{color:#e74c3c}.score-team.blue .team-name{color:#3498db}
.score-team.red .team-score{background:#e74c3c;color:#fff}.score-team.blue .team-score{background:#3498db;color:#fff}

.controls{margin-bottom:0.5vh;flex-shrink:0}
button{padding:clamp(8px,1.5vh,20px) clamp(15px,2vw,40px);font-size:clamp(0.9rem,2.2vh,1.8rem);border:none;border-radius:clamp(6px,0.8vw,12px);margin:clamp(2px,0.3vw,8px);font-weight:bold;cursor:pointer;transition:transform .2s}
button:hover{transform:scale(1.05)}button:active{transform:scale(.95)}
.btn-new{background:#4CAF50;color:#fff}.btn-key{background:#FF9800;color:#fff}
.btn-reset{background:#e74c3c;color:#fff;padding:clamp(6px,1vh,15px) clamp(10px,1.5vw,30px);font-size:clamp(0.8rem,1.8vh,1.4rem)}

#status{font-size:clamp(1rem,2.8vh,2.5rem);margin-bottom:0.5vh;font-weight:bold;flex-shrink:0}
#status .team-red{color:#e74c3c}#status .team-blue{color:#3498db}

/* GAME BOARD - kluczowe dla TV */
.grid-container{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    grid-template-rows:repeat(5,1fr);
    gap:clamp(4px,0.8vmin,15px);
    flex-grow:1;
    width:100%;
    height:100%;
    max-height:calc(100vh - 25vh);
    max-width:calc((100vh - 25vh) * 1.1);
    margin:auto;
}
.card{
    background:linear-gradient(145deg,#f0f0f0,#d0d0d0);
    color:#222;
    border-radius:clamp(6px,1vmin,15px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(12px,3.5vmin,42px);
    font-weight:bold;
    text-transform:uppercase;
    cursor:pointer;
    user-select:none;
    padding:clamp(4px,1vmin,15px);
    transition:transform .15s,box-shadow .15s;
    text-align:center;
    word-break:break-word;
    overflow:hidden;
    box-shadow:0 clamp(2px,0.4vmin,6px) clamp(4px,0.8vmin,12px) rgba(0,0,0,0.3);
    text-shadow:1px 1px 0 rgba(255,255,255,0.5);
    letter-spacing:0.5px;
}
.card:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 clamp(4px,0.6vmin,10px) clamp(8px,1.2vmin,20px) rgba(0,0,0,0.4)}
.is-red{--true:#e74c3c;--text:#fff}.is-blue{--true:#3498db;--text:#fff}.is-neutral{--true:#7f8c8d;--text:#fff}.is-assassin{--true:#1a1a1a;--text:#fff}
.card.revealed{background:var(--true);color:var(--text);cursor:default;box-shadow:inset 0 0 clamp(10px,2vmin,30px) rgba(0,0,0,0.3);text-shadow:1px 1px 2px rgba(0,0,0,0.5)}
.card.revealed:hover{transform:none;box-shadow:inset 0 0 clamp(10px,2vmin,30px) rgba(0,0,0,0.3)}
body.spymaster-mode .card{border:clamp(3px,0.6vmin,8px) solid var(--true);box-shadow:0 0 clamp(10px,2vmin,25px) var(--true)}
body.spymaster-mode .card.revealed{border:none;box-shadow:inset 0 0 clamp(10px,2vmin,30px) rgba(0,0,0,0.3)}

/* OVERLAYS */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:999;padding:2vh 2vw;overflow-y:auto}
.home-container{max-width:min(900px,90vw);width:90%}
.home-title{font-size:clamp(2.5rem,8vmin,5rem);margin-bottom:2vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.home-subtitle{font-size:clamp(1rem,3vmin,2rem);color:#aaa;margin-bottom:4vh}
.mode-selection{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(300px,80vw),1fr));gap:clamp(15px,3vmin,40px);margin-bottom:3vh}
.mode-card{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);cursor:pointer;transition:all .3s;border:clamp(2px,0.4vmin,5px) solid transparent}
.mode-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.5)}
.mode-card.classic{border-color:#4CAF50}.mode-card.crazy{border-color:#FF9800}
.mode-icon{font-size:clamp(3rem,8vmin,6rem);margin-bottom:2vh}
.mode-title{font-size:clamp(1.5rem,4vmin,3rem);margin-bottom:1.5vh;font-weight:bold}
.mode-card.classic .mode-title{color:#4CAF50}.mode-card.crazy .mode-title{color:#FF9800}
.mode-description{font-size:clamp(1rem,2.5vmin,1.5rem);color:#aaa}
.mode-features{margin-top:2vh;text-align:left;font-size:clamp(0.9rem,2.2vmin,1.3rem);color:#888;list-style:none;padding:0}
.mode-features li{margin:clamp(4px,1vmin,10px) 0}

/* SETTINGS */
.settings-container{background:#2a2a2a;border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);max-width:min(800px,90vw);width:90%;max-height:90vh;overflow-y:auto}
.settings-title{font-size:clamp(1.8rem,5vmin,3rem);margin-bottom:3vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.team-setup{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(280px,80vw),1fr));gap:clamp(15px,3vmin,30px);margin-bottom:3vh}
.team-card{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);border:clamp(2px,0.4vmin,4px) solid}
.team-card.red{border-color:#e74c3c}.team-card.blue{border-color:#3498db}
.team-card h3{margin:0 0 2vh;font-size:clamp(1.2rem,3vmin,2rem)}
.team-card.red h3{color:#e74c3c}.team-card.blue h3{color:#3498db}
.avatar-picker{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(6px,1vmin,12px);margin-bottom:1.5vh}
.avatar-option{font-size:clamp(1.5rem,4vmin,3rem);padding:clamp(6px,1.2vmin,15px);background:#333;border-radius:clamp(8px,1vmin,15px);cursor:pointer;transition:all .2s;border:clamp(2px,0.4vmin,4px) solid transparent}
.avatar-option:hover{transform:scale(1.1);background:#444}
.avatar-option.selected{border-color:#4CAF50;background:#2d5016}
.team-card input{width:100%;padding:clamp(8px,1.5vmin,15px);font-size:clamp(1rem,2.5vmin,1.5rem);border-radius:clamp(6px,1vmin,12px);border:none;text-align:center;background:#333;color:#fff;margin-top:1vh}
.game-settings{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);margin-bottom:2vh}
.game-settings h3{color:#FF9800;margin-bottom:2vh;font-size:clamp(1.1rem,2.8vmin,1.8rem)}
.setting-row{display:flex;justify-content:space-between;align-items:center;margin:clamp(8px,1.5vmin,15px) 0;padding:clamp(8px,1.5vmin,15px);background:#2a2a2a;border-radius:clamp(6px,1vmin,12px);flex-wrap:wrap;gap:10px}
.setting-row label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc}
.setting-row input,.setting-row select{padding:clamp(8px,1.5vmin,12px);font-size:clamp(0.95rem,2.2vmin,1.3rem);border-radius:clamp(5px,0.8vmin,10px);border:none;background:#333;color:#fff;width:clamp(100px,15vmin,150px);text-align:center}
.button-group{display:flex;gap:clamp(10px,2vmin,20px);margin-top:2vh;flex-wrap:wrap}

#endText{font-size:clamp(2rem,6vmin,5rem);animation:pop .6s ease;margin-bottom:3vh}
@keyframes pop{0%{transform:scale(.6);opacity:0}100%{transform:scale(1);opacity:1}}
.confetti{position:fixed;top:-10px;width:clamp(8px,1.5vmin,15px);height:clamp(8px,1.5vmin,15px);animation:fall 3s linear forwards;pointer-events:none}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:0}}

/* MA≈ÅE EKRANY (telefony) */
@media(max-width:600px){
.scoreboard{flex-direction:column;gap:1vh;align-items:center}
.score-team{width:100%;max-width:300px;justify-content:space-between}
.side-panel{width:12vw;min-width:35px}
.side-card{width:100%;max-width:45px;height:auto;aspect-ratio:1.3/1}
.grid-container{max-height:calc(100vh - 35vh)}
}

/* NISKIE EKRANY */
@media(max-height:500px){
.game-header{padding:0}
.game-header h1{font-size:1.2rem}
#gameModeLabel{display:none}
.scoreboard{margin-bottom:2px}
.score-team{padding:5px 10px}
.controls{margin-bottom:2px}
.controls button{padding:5px 10px;margin:1px}
#status{font-size:0.9rem;margin-bottom:2px}
.grid-container{max-height:calc(100vh - 20vh)}
}

/* DU≈ªE EKRANY (TV, projektory) */
@media(min-width:1200px) and (min-height:800px){
.card{font-size:clamp(18px,3.2vmin,48px);border-radius:clamp(10px,1.2vmin,20px)}
.side-card{border-radius:clamp(8px,1vmin,15px)}
}
@media(min-width:1800px){
.game-header h1{font-size:clamp(2.5rem,4vh,5rem)}
#gameModeLabel{font-size:clamp(1.2rem,2vh,2rem)}
#status{font-size:clamp(1.5rem,3vh,3rem)}
}
</style>
</head>
<body>

<div class="overlay" id="homeScreen" style="display:flex">
<div class="home-container">
<h1 class="home-title">üéØ TAJNIACY</h1>
<p class="home-subtitle">Gra towarzyska</p>
<div class="mode-selection">
<div class="mode-card classic" onclick="selectMode('classic')">
<div class="mode-icon">üé≤</div>
<div class="mode-title">KLASYCZNA</div>
<div class="mode-description">Szybki start z tradycyjnymi zasadami</div>
<ul class="mode-features"><li>‚úì Standardowa plansza 5x5</li><li>‚úì 1 zab√≥jca, 7 neutralnych</li><li>‚úì 8/9 agent√≥w</li></ul>
</div>
<div class="mode-card crazy" onclick="selectMode('crazy')">
<div class="mode-icon">üé™</div>
<div class="mode-title">SZALONA</div>
<div class="mode-description">Wiƒôcej zab√≥jc√≥w, wiƒôcej emocji!</div>
<ul class="mode-features"><li>‚ö° Od 1 do 7 zab√≥jc√≥w</li><li>‚ö° Mniej neutralnych kart</li><li>‚ö° Wybierz kto zaczyna</li></ul>
</div>
</div>
</div>
</div>

<div class="overlay" id="classicSettings">
<div class="settings-container">
<h2 class="settings-title">üéÆ Tryb Klasyczny</h2>
<div class="team-setup">
<div class="team-card red">
<h3>üî¥ Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="classicRedPicker"></div>
<input id="classicRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>üîµ Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="classicBluePicker"></div>
<input id="classicBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<div class="setting-row"><label>üé¥ Talia kart:</label><select id="classicDeck"><option value="standard">Standardowa</option><option value="adult">Dla doros≈Çych (18+)</option></select></div>
<div class="setting-row"><label>üèÜ Rundy do wygranej:</label><input id="classicWinTarget" type="number" min="1" max="10" value="3"></div>
<div class="setting-row"><label>üîä D≈∫wiƒôki:</label><select id="classicSound"><option value="true">W≈ÇƒÖczone</option><option value="false">Wy≈ÇƒÖczone</option></select></div>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startClassic()" style="flex:2;font-size:1.3rem">‚ñ∂Ô∏è Start</button>
</div>
</div>
</div>

<div class="overlay" id="crazySettings">
<div class="settings-container">
<h2 class="settings-title">üé™ Tryb Szalony</h2>
<div class="team-setup">
<div class="team-card red">
<h3>üî¥ Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="crazyRedPicker"></div>
<input id="crazyRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>üîµ Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="crazyBluePicker"></div>
<input id="crazyBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<h3 style="color:#FF9800;margin-bottom:15px">‚öôÔ∏è Zaawansowane Ustawienia</h3>
<div class="setting-row"><label>üé¥ Talia:</label><select id="crazyDeck"><option value="standard">Standardowa</option><option value="adult">Dla doros≈Çych</option></select></div>
<div class="setting-row"><label>üíÄ Zab√≥jcy:</label><input id="crazyAssassins" type="number" min="1" max="7" value="1" onchange="updateAssassins()"></div>
<div class="setting-row"><label>üòê Neutralne:</label><input id="crazyNeutral" type="number" value="7" readonly style="background:#222"></div>
<div class="setting-row"><label>üéØ Zaczyna:</label><select id="crazyStarter"><option value="random">üé≤ Losowo</option><option value="red">üî¥ Czerwoni</option><option value="blue">üîµ Niebiescy</option></select></div>
<div class="setting-row"><label>üèÜ Rundy:</label><input id="crazyWinTarget" type="number" min="1" max="10" value="3"></div>
<div class="setting-row"><label>üîä D≈∫wiƒôki:</label><select id="crazySound"><option value="true">W≈ÇƒÖczone</option><option value="false">Wy≈ÇƒÖczone</option></select></div>
</div>
<div style="background:#1a1a1a;border-radius:10px;padding:15px;margin-bottom:20px">
<p style="color:#4CAF50;margin:0;font-size:.95rem">‚úì Wiƒôcej zab√≥jc√≥w = mniej neutralnych kart</p>
<p style="color:#888;font-size:.9rem;margin:5px 0 0" id="cardInfo">Zab√≥jcy: 1 | Neutralne: 7</p>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startCrazy()" style="flex:2;font-size:1.3rem">‚ñ∂Ô∏è Start</button>
</div>
</div>
</div>

<div id="gameScreen">
<div class="game-header">
<h1>üéØ TAJNIACY</h1>
<div id="gameModeLabel">üé≤ Tryb Klasyczny</div>
</div>
<div class="scoreboard">
<div class="score-team red"><div class="team-info"><div class="team-emoji" id="scoreRedEmoji">üêâ</div><div class="team-name" id="scoreRedName">Czerwoni</div></div><div class="team-score" id="scoreRedPoints">0</div></div>
<div class="score-team blue"><div class="team-info"><div class="team-emoji" id="scoreBlueEmoji">ü¶à</div><div class="team-name" id="scoreBlueName">Niebiescy</div></div><div class="team-score" id="scoreBluePoints">0</div></div>
</div>
<div class="controls">
<button class="btn-new" onclick="confirmNewRound()">üîÑ Nowa runda</button>
<button class="btn-key" id="keyBtn" onclick="toggleKey()">üëÅÔ∏è Poka≈º klucz</button>
<button class="btn-reset" onclick="confirmBack()">üè† Menu</button>
</div>
<div id="status">ZaczynajƒÖ: ...</div>
<div class="main-container">
<div class="side-panel" id="redPanel"><div class="side-counter red" id="redCounter">0</div></div>
<div class="center-area"><div class="grid-container" id="board"></div></div>
<div class="side-panel" id="bluePanel"><div class="side-counter blue" id="blueCounter">0</div></div>
</div>
</div>

<div class="overlay" id="endOverlay">
<div id="endText"></div>
<button class="btn-new" id="nextRoundBtn" onclick="initRound()">‚û°Ô∏è Kolejna runda</button>
<button class="btn-reset" onclick="confirmBack()">üè† Menu</button>
</div>

<div class="overlay" id="assassinOverlay">
<h2>üíÄ ZAB√ìJCA!</h2>
<p style="font-size:1.2rem;margin:20px 0">Kt√≥ra dru≈ºyna trafi≈Ça na zab√≥jcƒô?</p>
<button class="btn-new" style="background:#e74c3c;margin:10px" onclick="assassinHit('red')">üî¥ <span id="assRedText">Czerwoni</span></button>
<button class="btn-new" style="background:#3498db;margin:10px" onclick="assassinHit('blue')">üîµ <span id="assBlueText">Niebiescy</span></button>
</div>

<div class="overlay" id="keyWarning">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üëÅÔ∏è Poka≈º klucz?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Uwaga! To ujawni wszystkie karty.</p>
<p style="font-size:1rem;color:#ccc;margin-bottom:30px">Upewnij siƒô, ≈ºe tylko szpiedzy widzƒÖ ekran!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('keyWarning')">‚ùå Anuluj</button>
<button class="btn-key" onclick="showKey()">üëÅÔ∏è Poka≈º</button>
</div>
</div>
</div>

<div class="overlay" id="newRoundConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üîÑ Nowa runda?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Obecna rozgrywka zostanie zresetowana.</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('newRoundConfirm')">‚ùå Anuluj</button>
<button class="btn-new" onclick="hideO('newRoundConfirm');initRound()">üîÑ Nowa runda</button>
</div>
</div>
</div>

<div class="overlay" id="backConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üè† Powr√≥t do menu?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Ca≈Çy postƒôp meczu zostanie utracony!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('backConfirm')">‚ùå Anuluj</button>
<button class="btn-key" style="background:#e74c3c" onclick="resetMatch()">üè† Menu</button>
</div>
</div>
</div>

<script>
const WORDS=["Dinozaur","L√≥d","Szpieg","Zamek","Ksiƒô≈ºyc","Pies","D≈∫wig","Afryka","Piramida","Pilot","Szpital","Oko","Nied≈∫wied≈∫","Orze≈Ç","Trawa","Bombowiec","PociƒÖg","Doktor","Ziemia","Wieloryb","Szko≈Ça","G√≥ra","But","Bank","Ryba","Anio≈Ç","PajƒÖk","Klucz","Z≈Çoto","Papier","Jab≈Çko","Ogie≈Ñ","Samolot","Kod","Mecz","Tort","Gwiazda","Policja","Woda","Mur","Kr√≥lowa","Rycerz","Wiatr","Radio","Las","Duch","Zegarek","Rzeka","Komputer","KsiƒÖ≈ºka","Kawa","Cukier","Miasto","Most","Grom","S≈Ço≈Ñce","Chmura","≈önieg","Deszcz","Burza","Sztorm","Ocean","Pla≈ºa","Wyspa","D≈ºungla","Pustynia","Lawina","Wulkan","Trzƒôsienie","Robot","Laser","Rakieta","Planeta","Kometa","Satelita","Astronauta","Mars","Gitara","Pianino","Bƒôben","TrƒÖbka","Skrzypce","Opera","Koncert","Muzyka","Malarz","Rze≈∫ba","Galeria","Obraz","Farba","Pƒôdzel","Paleta","Muzeum","Pi≈Çka","Stadion","Bramka","Sƒôdzia","Mistrz","Medal","Puchar","Olimpiada","Smok","Czarodziej","Elf","Krasnolud","Troll","Goblin","Mag","Kapitan","Statek","Kotwica","≈ªagiel","Pirat","Skarb","Mapa","Kompas","Telefon","Ekran","Mysz","Klawiatura","Monitor","Drukarka","Kamera","Mikrofon"];
const ADULT=["Kamasutra","Orgazm","Seks","Erotyka","Striptiz","Kochanek","Gangster","Mafioso","Grzech","Piek≈Ço","Szatan","Demon","Alkohol","W√≥dka","Narkotyk","Dealer","Przemyt","Zab√≥jca","Morderca","Trucizna","Bro≈Ñ","Rewolwer","Karabin","Granat","Dynamit","Poker","Kasyno","Hazard","Ruletka","Oszust","Kanciarz","Wiƒôzienie","Kraty","Kajdanki","Policjant","Areszt","Cela","Wyrok","Whisky","Piwo","Wino","Kac","Impreza","Disco","Klub","Jackpot","Stawka","Blef","Hip-Hop","Rap","Skandal"];
const EMOJIS_RED=["üêâ","ü¶Å","üî•","üå∂Ô∏è","ü¶Ö","üöÄ","‚ö°","üíé"];
const EMOJIS_BLUE=["ü¶à","üê∫","‚ùÑÔ∏è","üåä","ü¶ã","üõ∏","‚≠ê","üîÆ"];

let wordList=WORDS,gameMode='classic',gameOver=false,isSpymaster=false,sideCards={red:[],blue:[]};
const team={red:{name:"Czerwoni",emoji:"üêâ",score:0},blue:{name:"Niebiescy",emoji:"ü¶à",score:0}};
const cfg={winTarget:3,sound:true,assassins:1,starter:'random',startAgents:9,otherAgents:8,neutral:7,width:5,height:5};
let remaining={red:0,blue:0};

const $=id=>document.getElementById(id);
const showO=id=>$(id).style.display='flex';
const hideO=id=>$(id).style.display='none';
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

function buildPickers(){
    ['classic','crazy'].forEach(mode=>{
        [['Red',EMOJIS_RED,'red'],['Blue',EMOJIS_BLUE,'blue']].forEach(([suffix,emojis,t])=>{
            const picker=$(mode+suffix+'Picker');
            if(!picker)return;
            picker.innerHTML='';
            emojis.forEach((e,i)=>{
                const div=document.createElement('div');
                div.className='avatar-option'+(i===0?' selected':'');
                div.dataset.emoji=e;
                div.textContent=e;
                div.onclick=()=>{
                    picker.querySelectorAll('.avatar-option').forEach(o=>o.classList.remove('selected'));
                    div.classList.add('selected');
                    team[t].emoji=e;
                };
                picker.appendChild(div);
            });
        });
    });
}

function selectMode(mode){
    gameMode=mode;
    hideO('homeScreen');
    showO(mode==='classic'?'classicSettings':'crazySettings');
    if(mode==='crazy')updateAssassins();
}

function backToHome(){hideO('classicSettings');hideO('crazySettings');showO('homeScreen')}

function updateAssassins(){
    const assassins=Math.max(1,Math.min(7,+$('crazyAssassins').value||1));
    const neutral=8-assassins;
    $('crazyAssassins').value=assassins;
    $('crazyNeutral').value=neutral;
    $('cardInfo').textContent=`Zab√≥jcy: ${assassins} | Neutralne: ${neutral}`;
}

function startClassic(){
    team.red.name=$('classicRedName').value||'Czerwoni';
    team.blue.name=$('classicBlueName').value||'Niebiescy';
    cfg.winTarget=Math.max(1,+$('classicWinTarget').value||3);
    cfg.sound=$('classicSound').value==='true';
    wordList=$('classicDeck').value==='adult'?ADULT:WORDS;
    cfg.assassins=1;cfg.starter='random';cfg.startAgents=9;cfg.otherAgents=8;cfg.neutral=7;cfg.width=5;cfg.height=5;
    team.red.score=team.blue.score=0;
    hideO('classicSettings');
    $('gameScreen').style.display='flex';
    $('gameModeLabel').textContent='üé≤ Tryb Klasyczny';
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function startCrazy(){
    team.red.name=$('crazyRedName').value||'Czerwoni';
    team.blue.name=$('crazyBlueName').value||'Niebiescy';
    wordList=$('crazyDeck').value==='adult'?ADULT:WORDS;
    cfg.assassins=Math.max(1,Math.min(7,+$('crazyAssassins').value||1));
    cfg.starter=$('crazyStarter').value;
    cfg.startAgents=9;
    cfg.otherAgents=8;
    cfg.neutral=8-cfg.assassins;
    cfg.width=5;
    cfg.height=5;
    cfg.winTarget=Math.max(1,+$('crazyWinTarget').value||3);
    cfg.sound=$('crazySound').value==='true';
    team.red.score=team.blue.score=0;
    hideO('crazySettings');
    $('gameScreen').style.display='flex';
    $('gameModeLabel').textContent='üé™ Tryb Szalony';
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function updateScore(){
    $('scoreRedEmoji').textContent=team.red.emoji;$('scoreRedName').textContent=team.red.name;$('scoreRedPoints').textContent=team.red.score;
    $('scoreBlueEmoji').textContent=team.blue.emoji;$('scoreBlueName').textContent=team.blue.name;$('scoreBluePoints').textContent=team.blue.score;
}

function createSideCards(){
    ['red','blue'].forEach(c=>{
        const panel=$(c+'Panel');
        panel.querySelectorAll('.side-card').forEach(e=>e.remove());
        sideCards[c]=[];
        $(c+'Counter').textContent=remaining[c];
        for(let i=0;i<remaining[c];i++){
            const card=document.createElement('div');
            card.className='side-card '+c;
            card.textContent=team[c].emoji;
            panel.appendChild(card);
            sideCards[c].push(card);
        }
    });
}

function updateSideCard(c){
    const unrevealed=sideCards[c].filter(e=>!e.classList.contains('revealed'));
    if(unrevealed.length)unrevealed[0].classList.add('revealed');
    $(c+'Counter').textContent=remaining[c];
}

function genLayout(roles,w,h){
    let attempts=0,result;
    do{result=shuffle([...roles]);attempts++}while(!checkLayout(result,w,h)&&attempts<50);
    return result;
}

function checkLayout(r,w,h){
    for(let row=0;row<h;row++)for(let col=0;col<=w-3;col++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+1]&&r[i+1]===r[i+2])return false}
    for(let col=0;col<w;col++)for(let row=0;row<=h-3;row++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+w]&&r[i+w]===r[i+2*w])return false}
    return true;
}

function initRound(){
    const board=$('board'),status=$('status');
    board.innerHTML='';hideO('endOverlay');
    gameOver=false;isSpymaster=false;
    document.body.classList.remove('spymaster-mode');
    $('keyBtn').textContent='üëÅÔ∏è Poka≈º klucz';
    
    const redStarts=cfg.starter==='random'?Math.random()<.5:cfg.starter==='red';
    remaining={red:redStarts?cfg.startAgents:cfg.otherAgents,blue:redStarts?cfg.otherAgents:cfg.startAgents};
    createSideCards();
    
    status.innerHTML=`ZaczynajƒÖ: <span class="team-${redStarts?'red':'blue'}">${team[redStarts?'red':'blue'].emoji} ${team[redStarts?'red':'blue'].name}</span>`;
    
    let roles=[...Array(cfg.assassins).fill('assassin'),...Array(cfg.neutral).fill('neutral'),...Array(remaining.red).fill('red'),...Array(remaining.blue).fill('blue')];
    roles=genLayout(roles,cfg.width,cfg.height);
    
    const words=shuffle([...wordList]).slice(0,cfg.width*cfg.height);
    
    words.forEach((word,i)=>{
        if(i>=roles.length)return;
        const card=document.createElement('div');
        card.className=`card is-${roles[i]}`;
        card.textContent=word;
        card.onclick=()=>{
            if(gameOver||isSpymaster||card.classList.contains('revealed'))return;
            card.classList.add('revealed');
            playSound('click');
            if(roles[i]==='assassin'){
                gameOver=true;
                $('assRedText').textContent=team.red.name;
                $('assBlueText').textContent=team.blue.name;
                showO('assassinOverlay');
                return;
            }
            if(roles[i]==='red'){remaining.red--;updateSideCard('red');if(!remaining.red)endRound(`üî¥ ${team.red.name} wygrywa rundƒô!`,'red')}
            if(roles[i]==='blue'){remaining.blue--;updateSideCard('blue');if(!remaining.blue)endRound(`üîµ ${team.blue.name} wygrywa rundƒô!`,'blue')}
        };
        board.appendChild(card);
    });
}

function endRound(text,winner){
    gameOver=true;
    $('endText').textContent=text;
    showO('endOverlay');
    if(winner){
        team[winner].score++;
        updateScore();
        if(team[winner].score>=cfg.winTarget){
            confetti(winner==='red'?'#e74c3c':'#3498db');
            playSound('win');
            $('endText').textContent=`üèÜ ${team[winner].emoji} ${team[winner].name} WYGRYWAJƒÑ MECZ! üèÜ`;
            $('nextRoundBtn').style.display='none';
        }else{
            playSound('win');
            $('nextRoundBtn').style.display='inline-block';
        }
    }else{
        playSound('assassin');
        $('nextRoundBtn').style.display='inline-block';
    }
}

function assassinHit(loser){
    hideO('assassinOverlay');
    const winner=loser==='red'?'blue':'red';
    endRound(`üíÄ ZAB√ìJCA! ${team[loser].emoji} ${team[loser].name} przegrywajƒÖ!`,winner);
}

function toggleKey(){
    if(gameOver)return;
    if(!isSpymaster)showO('keyWarning');
    else{isSpymaster=false;document.body.classList.remove('spymaster-mode');$('keyBtn').textContent='üëÅÔ∏è Poka≈º klucz'}
}

function showKey(){
    hideO('keyWarning');
    isSpymaster=true;
    document.body.classList.add('spymaster-mode');
    $('keyBtn').textContent='‚ùå Ukryj klucz';
}

function confirmNewRound(){
    if(!gameOver&&$('board').children.length)showO('newRoundConfirm');
    else initRound();
}

function confirmBack(){showO('backConfirm')}

function resetMatch(){
    hideO('backConfirm');hideO('endOverlay');
    $('gameScreen').style.display='none';
    showO('homeScreen');
    document.body.classList.remove('game-active','spymaster-mode');
    $('board').innerHTML='';
    ['red','blue'].forEach(c=>$(c+'Panel').querySelectorAll('.side-card').forEach(e=>e.remove()));
    team.red.score=team.blue.score=0;
    gameOver=false;isSpymaster=false;
}

function confetti(color){
    for(let i=0;i<100;i++){
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left=Math.random()*100+'vw';
        c.style.background=color;
        c.style.animationDuration=2+Math.random()*2+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),4000);
    }
}

let audioCtx=null;
function playSound(type){
    if(!cfg.sound)return;
    try{
        if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
        const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
        osc.connect(gain);gain.connect(audioCtx.destination);
        if(type==='assassin'){osc.frequency.value=100;gain.gain.setValueAtTime(.3,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.5);osc.start();osc.stop(audioCtx.currentTime+.5)}
        else if(type==='win'){[523,659,784].forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;g.gain.setValueAtTime(.2,audioCtx.currentTime+i*.15);g.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+i*.15+.3);o.start(audioCtx.currentTime+i*.15);o.stop(audioCtx.currentTime+i*.15+.3)})}
        else{osc.frequency.value=800;gain.gain.setValueAtTime(.15,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.1);osc.start();osc.stop(audioCtx.currentTime+.1)}
    }catch(e){}
}

buildPickers();
showO('homeScreen');
</script>
</body>
</html>
