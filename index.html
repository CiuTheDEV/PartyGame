<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tajniacy</title>
<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:#1a1a1a;color:#fff;text-align:center;padding:0;display:flex;flex-direction:column}
body.game-active{height:100vh;height:100dvh;overflow:hidden}

/* GAME SCREEN - nowy layout */
#gameScreen{display:none;flex-direction:column;height:100%;overflow:hidden}

.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(5px,1vh,15px) clamp(10px,2vw,30px);
    background:linear-gradient(180deg,#252525,#1a1a1a);
    flex-shrink:0;
    gap:clamp(10px,2vw,30px);
}

.team-bar{
    display:flex;
    align-items:center;
    gap:clamp(8px,1.5vw,20px);
    padding:clamp(8px,1.5vh,20px) clamp(15px,2.5vw,35px);
    border-radius:clamp(8px,1vw,15px);
    flex:1;
    max-width:40%;
}
.team-bar.red{
    background:linear-gradient(135deg,rgba(231,76,60,0.3),rgba(231,76,60,0.1));
    border:2px solid #e74c3c;
    justify-content:flex-start;
}
.team-bar.blue{
    background:linear-gradient(135deg,rgba(52,152,219,0.1),rgba(52,152,219,0.3));
    border:2px solid #3498db;
    justify-content:flex-end;
}

.team-bar .team-emoji{font-size:clamp(1.5rem,4vmin,3.5rem)}
.team-bar .team-name{
    font-size:clamp(1rem,2.5vmin,2rem);
    font-weight:bold;
    flex:1;
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
}
.team-bar.red .team-name{color:#e74c3c;text-align:left}
.team-bar.blue .team-name{color:#3498db;text-align:right}
.team-bar .team-score{
    font-size:clamp(1.5rem,4vmin,3.5rem);
    font-weight:bold;
    min-width:clamp(40px,5vmin,80px);
    text-align:center;
    padding:clamp(3px,0.5vmin,8px) clamp(10px,1.5vmin,20px);
    border-radius:clamp(6px,0.8vmin,12px);
    flex-shrink:0;
}
.team-bar.red .team-score{background:#e74c3c}
.team-bar.blue .team-score{background:#3498db}

.top-controls{
    display:flex;
    gap:clamp(5px,1vw,15px);
    flex-shrink:0;
}

.icon-btn{
    width:clamp(40px,6vmin,70px);
    height:clamp(40px,6vmin,70px);
    border-radius:clamp(8px,1vmin,15px);
    border:none;
    background:#333;
    color:#fff;
    font-size:clamp(1.2rem,3vmin,2.5rem);
    cursor:pointer;
    transition:all .2s;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0;
}
.icon-btn:hover{background:#444;transform:scale(1.1)}
.icon-btn:active{transform:scale(0.95)}
.icon-btn.settings-btn{background:#555}
.icon-btn.active{background:#FF9800;box-shadow:0 0 15px rgba(255,152,0,0.5)}

.board-container{
    flex-grow:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:clamp(5px,1vmin,15px);
    min-height:0;
    overflow:hidden;
}

.grid-container{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    grid-template-rows:repeat(5,1fr);
    gap:clamp(4px,0.8vmin,12px);
    width:100%;
    height:100%;
}

.card{
    background:linear-gradient(145deg,#f5f5f5,#d5d5d5);
    color:#222;
    border-radius:clamp(8px,1.5vmin,20px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(14px,4vmin,52px);
    font-weight:bold;
    text-transform:uppercase;
    cursor:pointer;
    user-select:none;
    padding:clamp(5px,1vmin,15px);
    transition:transform .15s,box-shadow .15s;
    text-align:center;
    word-break:break-word;
    overflow:hidden;
    box-shadow:0 clamp(3px,0.6vmin,8px) clamp(6px,1.2vmin,16px) rgba(0,0,0,0.3);
    text-shadow:1px 1px 0 rgba(255,255,255,0.5);
    letter-spacing:0.5px;
}
.card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 clamp(6px,1vmin,14px) clamp(12px,2vmin,28px) rgba(0,0,0,0.4)}

.is-red{--true:#e74c3c;--text:#fff}
.is-blue{--true:#3498db;--text:#fff}
.is-neutral{--true:#7f8c8d;--text:#fff}
.is-assassin{--true:#1a1a1a;--text:#fff}

.card.revealed{
    background:var(--true);
    color:var(--text);
    cursor:default;
    box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3);
    text-shadow:2px 2px 4px rgba(0,0,0,0.5);
}
.card.revealed:hover{transform:none;box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3)}

body.spymaster-mode .card{
    border:clamp(4px,0.8vmin,10px) solid var(--true);
    box-shadow:0 0 clamp(15px,3vmin,35px) var(--true);
}
body.spymaster-mode .card.revealed{border:none;box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3)}

.bottom-bar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:clamp(5px,1vh,12px) clamp(10px,2vw,30px);
    background:linear-gradient(0deg,#252525,#1a1a1a);
    flex-shrink:0;
    gap:clamp(5px,1vw,20px);
    overflow:hidden;
}

.remaining-cards{
    display:flex;
    gap:clamp(2px,0.4vmin,8px);
    align-items:center;
    flex-shrink:1;
    min-width:0;
    flex-wrap:wrap;
    max-width:45%;
}
.remaining-cards.red{justify-content:flex-start}
.remaining-cards.blue{flex-direction:row-reverse;justify-content:flex-start}

.remaining-card{
    width:clamp(28px,4vmin,55px);
    height:clamp(36px,5.5vmin,70px);
    border-radius:clamp(4px,0.6vmin,10px);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    transition:all .3s;
    box-shadow:0 2px 5px rgba(0,0,0,0.3);
    gap:1px;
    flex-shrink:0;
}
.remaining-card .card-emoji{font-size:clamp(0.8rem,2vmin,1.6rem)}
.remaining-card .card-num{font-weight:bold;opacity:0.9;font-size:clamp(0.65rem,1.5vmin,1.2rem)}
.remaining-cards.red .remaining-card{background:#e74c3c}
.remaining-cards.blue .remaining-card{background:#3498db}
.remaining-card.revealed{opacity:0.2;transform:scale(0.85)}

#status{
    font-size:clamp(0.9rem,2.5vmin,1.8rem);
    font-weight:bold;
    white-space:nowrap;
    padding:0 clamp(10px,2vw,30px);
}
#status .team-red{color:#e74c3c}
#status .team-blue{color:#3498db}

/* OVERLAYS */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:999;padding:2vh 2vw;overflow-y:auto}
.home-container{max-width:min(900px,90vw);width:90%}
.home-title{font-size:clamp(2.5rem,8vmin,5rem);margin-bottom:2vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.home-subtitle{font-size:clamp(1rem,3vmin,2rem);color:#aaa;margin-bottom:4vh}
.mode-selection{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(300px,80vw),1fr));gap:clamp(15px,3vmin,40px);margin-bottom:3vh}
.mode-card{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);cursor:pointer;transition:all .3s;border:clamp(2px,0.4vmin,5px) solid transparent}
.mode-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.5)}
.mode-card.classic{border-color:#4CAF50}.mode-card.crazy{border-color:#FF9800}
.mode-icon{font-size:clamp(3rem,8vmin,6rem);margin-bottom:2vh}
.mode-title{font-size:clamp(1.5rem,4vmin,3rem);margin-bottom:1.5vh;font-weight:bold}
.mode-card.classic .mode-title{color:#4CAF50}.mode-card.crazy .mode-title{color:#FF9800}
.mode-description{font-size:clamp(1rem,2.5vmin,1.5rem);color:#aaa}
.mode-features{margin-top:2vh;text-align:left;font-size:clamp(0.9rem,2.2vmin,1.3rem);color:#888;list-style:none;padding:0}
.mode-features li{margin:clamp(4px,1vmin,10px) 0}

/* SETTINGS */
.settings-container{background:#2a2a2a;border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);max-width:min(800px,90vw);width:90%;max-height:90vh;overflow-y:auto}
.settings-title{font-size:clamp(1.8rem,5vmin,3rem);margin-bottom:3vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.team-setup{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(280px,80vw),1fr));gap:clamp(15px,3vmin,30px);margin-bottom:3vh}
.team-card{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);border:clamp(2px,0.4vmin,4px) solid}
.team-card.red{border-color:#e74c3c}.team-card.blue{border-color:#3498db}
.team-card h3{margin:0 0 2vh;font-size:clamp(1.2rem,3vmin,2rem)}
.team-card.red h3{color:#e74c3c}.team-card.blue h3{color:#3498db}
.avatar-picker{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(6px,1vmin,12px);margin-bottom:1.5vh}
.avatar-option{font-size:clamp(1.5rem,4vmin,3rem);padding:clamp(6px,1.2vmin,15px);background:#333;border-radius:clamp(8px,1vmin,15px);cursor:pointer;transition:all .2s;border:clamp(2px,0.4vmin,4px) solid transparent}
.avatar-option:hover{transform:scale(1.1);background:#444}
.avatar-option.selected{border-color:#4CAF50;background:#2d5016}
.team-card input{width:100%;padding:clamp(8px,1.5vmin,15px);font-size:clamp(1rem,2.5vmin,1.5rem);border-radius:clamp(6px,1vmin,12px);border:none;text-align:center;background:#333;color:#fff;margin-top:1vh}
.game-settings{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);margin-bottom:2vh}
.game-settings h3{color:#FF9800;margin-bottom:2vh;font-size:clamp(1.1rem,2.8vmin,1.8rem)}
.setting-row{display:flex;justify-content:space-between;align-items:center;margin:clamp(8px,1.5vmin,15px) 0;padding:clamp(8px,1.5vmin,15px);background:#2a2a2a;border-radius:clamp(6px,1vmin,12px);flex-wrap:wrap;gap:10px}
.setting-row label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc}
.setting-row input,.setting-row select{padding:clamp(8px,1.5vmin,12px);font-size:clamp(0.95rem,2.2vmin,1.3rem);border-radius:clamp(5px,0.8vmin,10px);border:none;background:#333;color:#fff;width:clamp(100px,15vmin,150px);text-align:center}
.button-group{display:flex;gap:clamp(10px,2vmin,20px);margin-top:2vh;flex-wrap:wrap}

button{padding:clamp(10px,2vh,20px) clamp(20px,3vw,40px);font-size:clamp(1rem,2.5vmin,1.5rem);border:none;border-radius:clamp(8px,1vmin,15px);font-weight:bold;cursor:pointer;transition:transform .2s}
button:hover{transform:scale(1.05)}button:active{transform:scale(.95)}
.btn-new{background:#4CAF50;color:#fff}
.btn-key{background:#FF9800;color:#fff}
.btn-reset{background:#e74c3c;color:#fff}

#endText{font-size:clamp(2rem,6vmin,5rem);animation:pop .6s ease;margin-bottom:3vh}
@keyframes pop{0%{transform:scale(.6);opacity:0}100%{transform:scale(1);opacity:1}}
.confetti{position:fixed;top:-10px;width:clamp(8px,1.5vmin,15px);height:clamp(8px,1.5vmin,15px);animation:fall 3s linear forwards;pointer-events:none}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:0}}

/* MA≈ÅE EKRANY (telefony) */
@media(max-width:600px){
.top-bar{flex-wrap:wrap;padding:5px 10px;gap:5px}
.team-bar{max-width:100%;flex:1 1 45%;padding:8px 10px;gap:5px}
.team-bar .team-name{display:none}
.top-controls{order:-1;width:100%;justify-content:center;margin-bottom:5px}
.icon-btn{width:45px;height:45px}
.bottom-bar{flex-wrap:wrap;padding:5px;gap:5px}
.remaining-cards{max-width:42%}
.remaining-card{width:24px;height:32px}
.remaining-card .card-emoji{font-size:0.7rem}
.remaining-card .card-num{font-size:0.6rem}
#status{font-size:0.8rem;order:-1;width:100%;text-align:center;padding:3px 0}
}

/* TABLETY (iPad) */
@media(min-width:601px) and (max-width:1024px){
.remaining-card{width:clamp(26px,3.5vmin,45px);height:clamp(34px,4.5vmin,58px)}
.remaining-card .card-emoji{font-size:clamp(0.75rem,1.8vmin,1.3rem)}
.remaining-card .card-num{font-size:clamp(0.6rem,1.3vmin,1rem)}
.remaining-cards{gap:clamp(2px,0.3vmin,5px)}
}

/* BARDZO MA≈ÅE EKRANY */
@media(max-height:500px){
.top-bar{padding:3px 10px}
.team-bar{padding:5px 8px}
.bottom-bar{padding:3px 10px}
.remaining-card{width:22px;height:30px}
.remaining-card .card-emoji{font-size:0.65rem}
.remaining-card .card-num{font-size:0.55rem}
#status{font-size:0.75rem}
.board-container{padding:3px}
}

/* DU≈ªE EKRANY (TV) */
@media(min-width:1400px) and (min-height:900px){
.card{font-size:clamp(24px,4.5vmin,60px)}
.icon-btn{width:clamp(60px,7vmin,90px);height:clamp(60px,7vmin,90px);font-size:clamp(2rem,4vmin,3.5rem)}
}
</style>
</head>
<body>

<div class="overlay" id="homeScreen" style="display:flex">
<div class="home-container">
<h1 class="home-title">üéØ TAJNIACY</h1>
<p class="home-subtitle">Gra towarzyska</p>
<div class="mode-selection">
<div class="mode-card classic" onclick="selectMode('classic')">
<div class="mode-icon">üé≤</div>
<div class="mode-title">KLASYCZNA</div>
<div class="mode-description">Szybki start z tradycyjnymi zasadami</div>
<ul class="mode-features"><li>‚úì Standardowa plansza 5x5</li><li>‚úì 1 zab√≥jca, 7 neutralnych</li><li>‚úì 8/9 agent√≥w</li></ul>
</div>
<div class="mode-card crazy" onclick="selectMode('crazy')">
<div class="mode-icon">üé™</div>
<div class="mode-title">SZALONA</div>
<div class="mode-description">Wiƒôcej zab√≥jc√≥w, wiƒôcej emocji!</div>
<ul class="mode-features"><li>‚ö° Od 1 do 7 zab√≥jc√≥w</li><li>‚ö° Mniej neutralnych kart</li><li>‚ö° Wybierz kto zaczyna</li></ul>
</div>
</div>
</div>
</div>

<div class="overlay" id="classicSettings">
<div class="settings-container">
<h2 class="settings-title">üéÆ Tryb Klasyczny</h2>
<div class="team-setup">
<div class="team-card red">
<h3>üî¥ Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="classicRedPicker"></div>
<input id="classicRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>üîµ Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="classicBluePicker"></div>
<input id="classicBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<div class="setting-row"><label>üé¥ Talia kart:</label><select id="classicDeck"><option value="standard">Standardowa</option><option value="adult">Dla doros≈Çych (18+)</option></select></div>
<div class="setting-row"><label>üèÜ Rundy do wygranej:</label><input id="classicWinTarget" type="number" min="1" max="10" value="3"></div>
<div class="setting-row"><label>üîä D≈∫wiƒôki:</label><select id="classicSound"><option value="true">W≈ÇƒÖczone</option><option value="false">Wy≈ÇƒÖczone</option></select></div>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startClassic()" style="flex:2;font-size:1.3rem">‚ñ∂Ô∏è Start</button>
</div>
</div>
</div>

<div class="overlay" id="crazySettings">
<div class="settings-container">
<h2 class="settings-title">üé™ Tryb Szalony</h2>
<div class="team-setup">
<div class="team-card red">
<h3>üî¥ Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="crazyRedPicker"></div>
<input id="crazyRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>üîµ Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="crazyBluePicker"></div>
<input id="crazyBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<h3 style="color:#FF9800;margin-bottom:15px">‚öôÔ∏è Zaawansowane Ustawienia</h3>
<div class="setting-row"><label>üé¥ Talia:</label><select id="crazyDeck"><option value="standard">Standardowa</option><option value="adult">Dla doros≈Çych</option></select></div>
<div class="setting-row"><label>üíÄ Zab√≥jcy:</label><input id="crazyAssassins" type="number" min="1" max="7" value="1" onchange="updateAssassins()"></div>
<div class="setting-row"><label>üòê Neutralne:</label><input id="crazyNeutral" type="number" value="7" readonly style="background:#222"></div>
<div class="setting-row"><label>üéØ Zaczyna:</label><select id="crazyStarter"><option value="random">üé≤ Losowo</option><option value="red">üî¥ Czerwoni</option><option value="blue">üîµ Niebiescy</option></select></div>
<div class="setting-row"><label>üèÜ Rundy:</label><input id="crazyWinTarget" type="number" min="1" max="10" value="3"></div>
<div class="setting-row"><label>üîä D≈∫wiƒôki:</label><select id="crazySound"><option value="true">W≈ÇƒÖczone</option><option value="false">Wy≈ÇƒÖczone</option></select></div>
</div>
<div style="background:#1a1a1a;border-radius:10px;padding:15px;margin-bottom:20px">
<p style="color:#4CAF50;margin:0;font-size:.95rem">‚úì Wiƒôcej zab√≥jc√≥w = mniej neutralnych kart</p>
<p style="color:#888;font-size:.9rem;margin:5px 0 0" id="cardInfo">Zab√≥jcy: 1 | Neutralne: 7</p>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startCrazy()" style="flex:2;font-size:1.3rem">‚ñ∂Ô∏è Start</button>
</div>
</div>
</div>

<div id="gameScreen">
<div class="top-bar">
<div class="team-bar red">
<span class="team-emoji" id="scoreRedEmoji">üêâ</span>
<span class="team-name" id="scoreRedName">Czerwoni</span>
<span class="team-score" id="scoreRedPoints">0</span>
</div>
<div class="top-controls">
<button class="icon-btn" onclick="confirmNewRound()" title="Nowa runda">üîÑ</button>
<button class="icon-btn" id="keyBtn" onclick="toggleKey()" title="Poka≈º klucz">üëÅÔ∏è</button>
<button class="icon-btn settings-btn" onclick="showO('gameSettings')" title="Ustawienia">‚öôÔ∏è</button>
</div>
<div class="team-bar blue">
<span class="team-score" id="scoreBluePoints">0</span>
<span class="team-name" id="scoreBlueName">Niebiescy</span>
<span class="team-emoji" id="scoreBlueEmoji">ü¶à</span>
</div>
</div>
<div class="board-container">
<div class="grid-container" id="board"></div>
</div>
<div class="bottom-bar">
<div class="remaining-cards red" id="redPanel"></div>
<div id="status">ZaczynajƒÖ: ...</div>
<div class="remaining-cards blue" id="bluePanel"></div>
</div>
</div>

<div class="overlay" id="gameSettings">
<div class="settings-container" style="max-width:400px">
<h2 style="font-size:1.8rem;margin-bottom:20px">‚öôÔ∏è Ustawienia</h2>
<div style="display:flex;flex-direction:column;gap:15px">
<button class="btn-new" onclick="hideO('gameSettings')" style="width:100%">‚ñ∂Ô∏è Kontynuuj grƒô</button>
<button class="btn-key" onclick="hideO('gameSettings');confirmNewRound()" style="width:100%">üîÑ Nowa runda</button>
<button class="btn-reset" onclick="hideO('gameSettings');confirmBack()" style="width:100%;padding:15px">üè† Powr√≥t do menu</button>
</div>
</div>
</div>

<div class="overlay" id="endOverlay">
<div id="endText"></div>
<button class="btn-new" id="nextRoundBtn" onclick="initRound()">‚û°Ô∏è Kolejna runda</button>
<button class="btn-reset" onclick="confirmBack()">üè† Menu</button>
</div>

<div class="overlay" id="assassinOverlay">
<h2>üíÄ ZAB√ìJCA!</h2>
<p style="font-size:1.2rem;margin:20px 0">Kt√≥ra dru≈ºyna trafi≈Ça na zab√≥jcƒô?</p>
<button class="btn-new" style="background:#e74c3c;margin:10px" onclick="assassinHit('red')">üî¥ <span id="assRedText">Czerwoni</span></button>
<button class="btn-new" style="background:#3498db;margin:10px" onclick="assassinHit('blue')">üîµ <span id="assBlueText">Niebiescy</span></button>
</div>

<div class="overlay" id="keyWarning">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üëÅÔ∏è Poka≈º klucz?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Uwaga! To ujawni wszystkie karty.</p>
<p style="font-size:1rem;color:#ccc;margin-bottom:30px">Upewnij siƒô, ≈ºe tylko szpiedzy widzƒÖ ekran!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('keyWarning')">‚ùå Anuluj</button>
<button class="btn-key" onclick="showKey()">üëÅÔ∏è Poka≈º</button>
</div>
</div>
</div>

<div class="overlay" id="newRoundConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üîÑ Nowa runda?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Obecna rozgrywka zostanie zresetowana.</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('newRoundConfirm')">‚ùå Anuluj</button>
<button class="btn-new" onclick="hideO('newRoundConfirm');initRound()">üîÑ Nowa runda</button>
</div>
</div>
</div>

<div class="overlay" id="backConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">üè† Powr√≥t do menu?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">‚ö†Ô∏è Ca≈Çy postƒôp meczu zostanie utracony!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('backConfirm')">‚ùå Anuluj</button>
<button class="btn-key" style="background:#e74c3c" onclick="resetMatch()">üè† Menu</button>
</div>
</div>
</div>

<script>
const WORDS=["Dinozaur","L√≥d","Szpieg","Zamek","Ksiƒô≈ºyc","Pies","D≈∫wig","Afryka","Piramida","Pilot","Szpital","Oko","Nied≈∫wied≈∫","Orze≈Ç","Trawa","Bombowiec","PociƒÖg","Doktor","Ziemia","Wieloryb","Szko≈Ça","G√≥ra","But","Bank","Ryba","Anio≈Ç","PajƒÖk","Klucz","Z≈Çoto","Papier","Jab≈Çko","Ogie≈Ñ","Samolot","Kod","Mecz","Tort","Gwiazda","Policja","Woda","Mur","Kr√≥lowa","Rycerz","Wiatr","Radio","Las","Duch","Zegarek","Rzeka","Komputer","KsiƒÖ≈ºka","Kawa","Cukier","Miasto","Most","Grom","S≈Ço≈Ñce","Chmura","≈önieg","Deszcz","Burza","Sztorm","Ocean","Pla≈ºa","Wyspa","D≈ºungla","Pustynia","Lawina","Wulkan","Trzƒôsienie","Robot","Laser","Rakieta","Planeta","Kometa","Satelita","Astronauta","Mars","Gitara","Pianino","Bƒôben","TrƒÖbka","Skrzypce","Opera","Koncert","Muzyka","Malarz","Rze≈∫ba","Galeria","Obraz","Farba","Pƒôdzel","Paleta","Muzeum","Pi≈Çka","Stadion","Bramka","Sƒôdzia","Mistrz","Medal","Puchar","Olimpiada","Smok","Czarodziej","Elf","Krasnolud","Troll","Goblin","Mag","Kapitan","Statek","Kotwica","≈ªagiel","Pirat","Skarb","Mapa","Kompas","Telefon","Ekran","Mysz","Klawiatura","Monitor","Drukarka","Kamera","Mikrofon"];
const ADULT=["Kamasutra","Orgazm","Seks","Erotyka","Striptiz","Kochanek","Gangster","Mafioso","Grzech","Piek≈Ço","Szatan","Demon","Alkohol","W√≥dka","Narkotyk","Dealer","Przemyt","Zab√≥jca","Morderca","Trucizna","Bro≈Ñ","Rewolwer","Karabin","Granat","Dynamit","Poker","Kasyno","Hazard","Ruletka","Oszust","Kanciarz","Wiƒôzienie","Kraty","Kajdanki","Policjant","Areszt","Cela","Wyrok","Whisky","Piwo","Wino","Kac","Impreza","Disco","Klub","Jackpot","Stawka","Blef","Hip-Hop","Rap","Skandal"];
const EMOJIS_RED=["üêâ","ü¶Å","üî•","üå∂Ô∏è","ü¶Ö","üöÄ","‚ö°","üíé"];
const EMOJIS_BLUE=["ü¶à","üê∫","‚ùÑÔ∏è","üåä","ü¶ã","üõ∏","‚≠ê","üîÆ"];

let wordList=WORDS,gameMode='classic',gameOver=false,isSpymaster=false,sideCards={red:[],blue:[]};
const team={red:{name:"Czerwoni",emoji:"üêâ",score:0},blue:{name:"Niebiescy",emoji:"ü¶à",score:0}};
const cfg={winTarget:3,sound:true,assassins:1,starter:'random',startAgents:9,otherAgents:8,neutral:7,width:5,height:5};
let remaining={red:0,blue:0};

const $=id=>document.getElementById(id);
const showO=id=>$(id).style.display='flex';
const hideO=id=>$(id).style.display='none';
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

function buildPickers(){
    ['classic','crazy'].forEach(mode=>{
        [['Red',EMOJIS_RED,'red'],['Blue',EMOJIS_BLUE,'blue']].forEach(([suffix,emojis,t])=>{
            const picker=$(mode+suffix+'Picker');
            if(!picker)return;
            picker.innerHTML='';
            emojis.forEach((e,i)=>{
                const div=document.createElement('div');
                div.className='avatar-option'+(i===0?' selected':'');
                div.dataset.emoji=e;
                div.textContent=e;
                div.onclick=()=>{
                    picker.querySelectorAll('.avatar-option').forEach(o=>o.classList.remove('selected'));
                    div.classList.add('selected');
                    team[t].emoji=e;
                };
                picker.appendChild(div);
            });
        });
    });
}

function selectMode(mode){
    gameMode=mode;
    hideO('homeScreen');
    showO(mode==='classic'?'classicSettings':'crazySettings');
    if(mode==='crazy')updateAssassins();
}

function backToHome(){hideO('classicSettings');hideO('crazySettings');showO('homeScreen')}

function updateAssassins(){
    const assassins=Math.max(1,Math.min(7,+$('crazyAssassins').value||1));
    const neutral=8-assassins;
    $('crazyAssassins').value=assassins;
    $('crazyNeutral').value=neutral;
    $('cardInfo').textContent=`Zab√≥jcy: ${assassins} | Neutralne: ${neutral}`;
}

function startClassic(){
    team.red.name=$('classicRedName').value||'Czerwoni';
    team.blue.name=$('classicBlueName').value||'Niebiescy';
    cfg.winTarget=Math.max(1,+$('classicWinTarget').value||3);
    cfg.sound=$('classicSound').value==='true';
    wordList=$('classicDeck').value==='adult'?ADULT:WORDS;
    cfg.assassins=1;cfg.starter='random';cfg.startAgents=9;cfg.otherAgents=8;cfg.neutral=7;cfg.width=5;cfg.height=5;
    team.red.score=team.blue.score=0;
    hideO('classicSettings');
    $('gameScreen').style.display='flex';
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function startCrazy(){
    team.red.name=$('crazyRedName').value||'Czerwoni';
    team.blue.name=$('crazyBlueName').value||'Niebiescy';
    wordList=$('crazyDeck').value==='adult'?ADULT:WORDS;
    cfg.assassins=Math.max(1,Math.min(7,+$('crazyAssassins').value||1));
    cfg.starter=$('crazyStarter').value;
    cfg.startAgents=9;
    cfg.otherAgents=8;
    cfg.neutral=8-cfg.assassins;
    cfg.width=5;
    cfg.height=5;
    cfg.winTarget=Math.max(1,+$('crazyWinTarget').value||3);
    cfg.sound=$('crazySound').value==='true';
    team.red.score=team.blue.score=0;
    hideO('crazySettings');
    $('gameScreen').style.display='flex';
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function updateScore(){
    $('scoreRedEmoji').textContent=team.red.emoji;$('scoreRedName').textContent=team.red.name;$('scoreRedPoints').textContent=team.red.score;
    $('scoreBlueEmoji').textContent=team.blue.emoji;$('scoreBlueName').textContent=team.blue.name;$('scoreBluePoints').textContent=team.blue.score;
}

function createSideCards(){
    ['red','blue'].forEach(c=>{
        const panel=$(c+'Panel');
        panel.innerHTML='';
        sideCards[c]=[];
        for(let i=0;i<remaining[c];i++){
            const card=document.createElement('div');
            card.className='remaining-card';
            card.innerHTML=`<span class="card-emoji">${team[c].emoji}</span><span class="card-num">${i+1}</span>`;
            panel.appendChild(card);
            sideCards[c].push(card);
        }
    });
}

function updateSideCard(c){
    const unrevealed=sideCards[c].filter(e=>!e.classList.contains('revealed'));
    if(unrevealed.length)unrevealed[unrevealed.length-1].classList.add('revealed');
}

function genLayout(roles,w,h){
    let attempts=0,result;
    do{result=shuffle([...roles]);attempts++}while(!checkLayout(result,w,h)&&attempts<50);
    return result;
}

function checkLayout(r,w,h){
    for(let row=0;row<h;row++)for(let col=0;col<=w-3;col++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+1]&&r[i+1]===r[i+2])return false}
    for(let col=0;col<w;col++)for(let row=0;row<=h-3;row++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+w]&&r[i+w]===r[i+2*w])return false}
    return true;
}

function initRound(){
    const board=$('board'),status=$('status');
    board.innerHTML='';hideO('endOverlay');
    gameOver=false;isSpymaster=false;
    document.body.classList.remove('spymaster-mode');
    $('keyBtn').textContent='üëÅÔ∏è';
    $('keyBtn').classList.remove('active');
    
    const redStarts=cfg.starter==='random'?Math.random()<.5:cfg.starter==='red';
    remaining={red:redStarts?cfg.startAgents:cfg.otherAgents,blue:redStarts?cfg.otherAgents:cfg.startAgents};
    createSideCards();
    
    status.innerHTML=`ZaczynajƒÖ: <span class="team-${redStarts?'red':'blue'}">${team[redStarts?'red':'blue'].emoji} ${team[redStarts?'red':'blue'].name}</span>`;
    
    let roles=[...Array(cfg.assassins).fill('assassin'),...Array(cfg.neutral).fill('neutral'),...Array(remaining.red).fill('red'),...Array(remaining.blue).fill('blue')];
    roles=genLayout(roles,cfg.width,cfg.height);
    
    const words=shuffle([...wordList]).slice(0,cfg.width*cfg.height);
    
    words.forEach((word,i)=>{
        if(i>=roles.length)return;
        const card=document.createElement('div');
        card.className=`card is-${roles[i]}`;
        card.textContent=word;
        card.onclick=()=>{
            if(gameOver||isSpymaster||card.classList.contains('revealed'))return;
            card.classList.add('revealed');
            playSound('click');
            if(roles[i]==='assassin'){
                gameOver=true;
                $('assRedText').textContent=team.red.name;
                $('assBlueText').textContent=team.blue.name;
                showO('assassinOverlay');
                return;
            }
            if(roles[i]==='red'){remaining.red--;updateSideCard('red');if(!remaining.red)endRound(`üî¥ ${team.red.name} wygrywa rundƒô!`,'red')}
            if(roles[i]==='blue'){remaining.blue--;updateSideCard('blue');if(!remaining.blue)endRound(`üîµ ${team.blue.name} wygrywa rundƒô!`,'blue')}
        };
        board.appendChild(card);
    });
}

function endRound(text,winner){
    gameOver=true;
    $('endText').textContent=text;
    showO('endOverlay');
    if(winner){
        team[winner].score++;
        updateScore();
        if(team[winner].score>=cfg.winTarget){
            confetti(winner==='red'?'#e74c3c':'#3498db');
            playSound('win');
            $('endText').textContent=`üèÜ ${team[winner].emoji} ${team[winner].name} WYGRYWAJƒÑ MECZ! üèÜ`;
            $('nextRoundBtn').style.display='none';
        }else{
            playSound('win');
            $('nextRoundBtn').style.display='inline-block';
        }
    }else{
        playSound('assassin');
        $('nextRoundBtn').style.display='inline-block';
    }
}

function assassinHit(loser){
    hideO('assassinOverlay');
    const winner=loser==='red'?'blue':'red';
    endRound(`üíÄ ZAB√ìJCA! ${team[loser].emoji} ${team[loser].name} przegrywajƒÖ!`,winner);
}

function toggleKey(){
    if(gameOver)return;
    if(!isSpymaster)showO('keyWarning');
    else{isSpymaster=false;document.body.classList.remove('spymaster-mode');$('keyBtn').textContent='üëÅÔ∏è';$('keyBtn').classList.remove('active')}
}

function showKey(){
    hideO('keyWarning');
    isSpymaster=true;
    document.body.classList.add('spymaster-mode');
    $('keyBtn').textContent='üëÅÔ∏è';
    $('keyBtn').classList.add('active');
}

function confirmNewRound(){
    hideO('gameSettings');
    if(!gameOver&&$('board').children.length)showO('newRoundConfirm');
    else initRound();
}

function confirmBack(){showO('backConfirm')}

function resetMatch(){
    hideO('backConfirm');hideO('endOverlay');hideO('gameSettings');
    $('gameScreen').style.display='none';
    showO('homeScreen');
    document.body.classList.remove('game-active','spymaster-mode');
    $('board').innerHTML='';
    $('redPanel').innerHTML='';
    $('bluePanel').innerHTML='';
    team.red.score=team.blue.score=0;
    gameOver=false;isSpymaster=false;
}

function confetti(color){
    for(let i=0;i<100;i++){
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left=Math.random()*100+'vw';
        c.style.background=color;
        c.style.animationDuration=2+Math.random()*2+'s';
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),4000);
    }
}

let audioCtx=null;
function playSound(type){
    if(!cfg.sound)return;
    try{
        if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
        const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
        osc.connect(gain);gain.connect(audioCtx.destination);
        if(type==='assassin'){osc.frequency.value=100;gain.gain.setValueAtTime(.3,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.5);osc.start();osc.stop(audioCtx.currentTime+.5)}
        else if(type==='win'){[523,659,784].forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;g.gain.setValueAtTime(.2,audioCtx.currentTime+i*.15);g.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+i*.15+.3);o.start(audioCtx.currentTime+i*.15);o.stop(audioCtx.currentTime+i*.15+.3)})}
        else{osc.frequency.value=800;gain.gain.setValueAtTime(.15,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.1);osc.start();osc.stop(audioCtx.currentTime+.1)}
    }catch(e){}
}

buildPickers();
showO('homeScreen');
</script>
</body>
</html>
