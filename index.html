<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tajniacy</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:#1a1a1a;color:#fff;text-align:center;padding:0;display:flex;flex-direction:column}
body.game-active{height:100vh;height:100dvh;overflow:hidden}

/* GAME SCREEN - nowy layout */
#gameScreen{display:none;flex-direction:column;height:100%;overflow:hidden}

.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(5px,1vh,15px) clamp(10px,2vw,30px);
    background:linear-gradient(180deg,#252525,#1a1a1a);
    flex-shrink:0;
    gap:clamp(10px,2vw,30px);
}

.team-bar{
    display:flex;
    align-items:center;
    gap:clamp(8px,1.5vw,20px);
    padding:clamp(8px,1.5vh,20px) clamp(15px,2.5vw,35px);
    border-radius:clamp(8px,1vw,15px);
    flex:1;
    max-width:40%;
}
.team-bar.red{
    background:linear-gradient(135deg,rgba(231,76,60,0.3),rgba(231,76,60,0.1));
    border:2px solid #e74c3c;
    justify-content:flex-start;
}
.team-bar.blue{
    background:linear-gradient(135deg,rgba(52,152,219,0.1),rgba(52,152,219,0.3));
    border:2px solid #3498db;
    justify-content:flex-end;
}

.team-bar .team-emoji{font-size:clamp(1.5rem,4vmin,3.5rem)}
.team-bar .team-name{
    font-size:clamp(1rem,2.5vmin,2rem);
    font-weight:bold;
    flex:1;
    min-width:0;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
}
.team-bar.red .team-name{color:#e74c3c;text-align:left}
.team-bar.blue .team-name{color:#3498db;text-align:right}
.team-bar .team-score{
    font-size:clamp(1.5rem,4vmin,3.5rem);
    font-weight:bold;
    min-width:clamp(40px,5vmin,80px);
    text-align:center;
    padding:clamp(3px,0.5vmin,8px) clamp(10px,1.5vmin,20px);
    border-radius:clamp(6px,0.8vmin,12px);
    flex-shrink:0;
}
.team-bar.red .team-score{background:#e74c3c}
.team-bar.blue .team-score{background:#3498db}

.top-controls{
    display:flex;
    gap:clamp(5px,1vw,15px);
    flex-shrink:0;
}

.icon-btn{
    width:clamp(40px,6vmin,70px);
    height:clamp(40px,6vmin,70px);
    border-radius:clamp(8px,1vmin,15px);
    border:none;
    background:#333;
    color:#fff;
    font-size:clamp(1.2rem,3vmin,2.5rem);
    cursor:pointer;
    transition:background .2s;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0;
    position:relative;
}
.icon-btn span{position:relative;z-index:2}
.icon-btn svg.hold-progress{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    z-index:1;
}
.icon-btn svg.hold-progress path{
    fill:none;
    stroke:#4CAF50;
    stroke-width:4;
    stroke-dasharray:1000;
    stroke-dashoffset:1000;
}
.icon-btn:hover{background:#444}
.icon-btn.settings-btn{background:#555}
.icon-btn.active{background:#FF9800;box-shadow:0 0 15px rgba(255,152,0,0.5)}

.board-container{
    flex-grow:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:clamp(5px,1vmin,15px);
    min-height:0;
    overflow:hidden;
}

.grid-container{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    grid-template-rows:repeat(5,1fr);
    gap:clamp(4px,0.8vmin,12px);
    width:100%;
    height:100%;
}

.card{
    background:#f5f5f5;
    color:#222;
    border-radius:clamp(8px,1.5vmin,20px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(14px,4vmin,52px);
    font-weight:bold;
    text-transform:uppercase;
    cursor:pointer;
    user-select:none;
    padding:clamp(5px,1vmin,15px);
    transition:transform .15s,box-shadow .15s,background .15s;
    text-align:center;
    word-break:break-word;
    overflow:hidden;
    box-shadow:0 clamp(2px,0.4vmin,6px) clamp(4px,0.8vmin,12px) rgba(0,0,0,0.3);
    letter-spacing:0.5px;
}
.card:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 clamp(4px,0.8vmin,10px) clamp(8px,1.5vmin,20px) rgba(0,0,0,0.4)}

/* Style talii */
.deck-white .card{background:#f5f5f5;color:#222}
.deck-white .card:hover{background:#fff}

.deck-classic .card{background:#2a2a2a;color:#f0f0f0;border:2px solid #3a3a3a}
.deck-classic .card:hover{background:#333}

.deck-night .card{background:linear-gradient(145deg,#1a1a2e,#0d0d18);color:#d0d0f0;border:2px solid #2a2a4e}
.deck-night .card:hover{background:linear-gradient(145deg,#252540,#12121f)}

.is-red{--true:#e74c3c;--text:#fff;--soft:rgba(231,76,60,0.7)}
.is-blue{--true:#3498db;--text:#fff;--soft:rgba(52,152,219,0.7)}
.is-neutral{--true:#7f8c8d;--text:#fff;--soft:rgba(127,140,141,0.5)}
.is-assassin{--true:#1a1a1a;--text:#fff;--soft:rgba(20,20,20,0.9)}

.card.revealed{
    background:var(--true)!important;
    color:var(--text)!important;
    cursor:default;
    box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3);
    text-shadow:2px 2px 4px rgba(0,0,0,0.5);
    border-color:var(--true)!important;
}
.card.revealed:hover{transform:none;box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3)}

/* Tryb klucza - pe≈Çne t≈Ço w stonowanych kolorach */
body.spymaster-mode .card{
    background:var(--soft)!important;
    color:#fff!important;
    text-shadow:1px 1px 3px rgba(0,0,0,0.5);
}
body.spymaster-mode .card:hover{
    transform:none;
}
body.spymaster-mode .card.is-assassin{
    color:#e74c3c!important;
    text-shadow:0 0 10px rgba(0,0,0,0.8);
    flex-direction:column;
    gap:clamp(2px,0.5vmin,8px);
}
body.spymaster-mode .card.is-assassin::after{
    content:'‚ò†';
    font-size:clamp(16px,3.5vmin,40px);
    opacity:0.9;
}
body.spymaster-mode .card.is-assassin.revealed::after{
    display:none;
}
body.spymaster-mode .card.revealed{
    background:var(--true)!important;
    box-shadow:inset 0 0 clamp(15px,3vmin,40px) rgba(0,0,0,0.3);
}

.bottom-bar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:clamp(5px,1vh,12px) clamp(10px,2vw,30px);
    background:linear-gradient(0deg,#252525,#1a1a1a);
    flex-shrink:0;
    gap:clamp(5px,1vw,20px);
    overflow:hidden;
}

.remaining-cards{
    display:flex;
    gap:clamp(2px,0.4vmin,8px);
    align-items:center;
    flex-shrink:1;
    min-width:0;
    flex-wrap:wrap;
    max-width:45%;
}
.remaining-cards.red{justify-content:flex-start}
.remaining-cards.blue{flex-direction:row-reverse;justify-content:flex-start}

.remaining-card{
    width:clamp(28px,4vmin,55px);
    height:clamp(36px,5.5vmin,70px);
    border-radius:clamp(4px,0.6vmin,10px);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    transition:all .3s;
    box-shadow:0 2px 5px rgba(0,0,0,0.3);
    gap:1px;
    flex-shrink:0;
}
.remaining-card .card-emoji{font-size:clamp(0.8rem,2vmin,1.6rem)}
.remaining-card .card-num{font-weight:bold;opacity:0.9;font-size:clamp(0.65rem,1.5vmin,1.2rem)}
.remaining-cards.red .remaining-card{background:#e74c3c}
.remaining-cards.blue .remaining-card{background:#3498db}
.remaining-card.revealed{opacity:0.2;transform:scale(0.85)}

#status{
    font-size:clamp(0.9rem,2.5vmin,1.8rem);
    font-weight:bold;
    white-space:nowrap;
    padding:0 clamp(10px,2vw,30px);
}
#status .team-red{color:#e74c3c}
#status .team-blue{color:#3498db}

/* OVERLAYS */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:999;padding:2vh 2vw;overflow-y:auto}
.home-container{max-width:min(900px,90vw);width:90%}
.home-title{font-size:clamp(2.5rem,8vmin,5rem);margin-bottom:2vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.home-subtitle{font-size:clamp(1rem,3vmin,2rem);color:#aaa;margin-bottom:4vh}
.mode-selection{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(300px,80vw),1fr));gap:clamp(15px,3vmin,40px);margin-bottom:3vh}
.mode-card{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);cursor:pointer;transition:all .3s;border:clamp(2px,0.4vmin,5px) solid transparent}
.mode-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.5)}
.mode-card.classic{border-color:#4CAF50}.mode-card.crazy{border-color:#FF9800}
.mode-icon{font-size:clamp(3rem,8vmin,6rem);margin-bottom:2vh}
.mode-title{font-size:clamp(1.5rem,4vmin,3rem);margin-bottom:1.5vh;font-weight:bold}
.mode-card.classic .mode-title{color:#4CAF50}.mode-card.crazy .mode-title{color:#FF9800}
.mode-description{font-size:clamp(1rem,2.5vmin,1.5rem);color:#aaa}
.mode-features{margin-top:2vh;text-align:left;font-size:clamp(0.9rem,2.2vmin,1.3rem);color:#888;list-style:none;padding:0}
.mode-features li{margin:clamp(4px,1vmin,10px) 0}

/* SETTINGS */
.settings-container{background:#2a2a2a;border-radius:clamp(15px,2vmin,25px);padding:clamp(20px,4vmin,50px);max-width:min(800px,90vw);width:90%;max-height:90vh;overflow-y:auto}
.settings-title{font-size:clamp(1.8rem,5vmin,3rem);margin-bottom:3vh;background:linear-gradient(135deg,#e74c3c,#3498db);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.team-setup{display:grid;grid-template-columns:repeat(auto-fit,minmax(min(280px,80vw),1fr));gap:clamp(15px,3vmin,30px);margin-bottom:3vh}
.team-card{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);border:clamp(2px,0.4vmin,4px) solid}
.team-card.red{border-color:#e74c3c}.team-card.blue{border-color:#3498db}
.team-card h3{margin:0 0 2vh;font-size:clamp(1.2rem,3vmin,2rem)}
.team-card.red h3{color:#e74c3c}.team-card.blue h3{color:#3498db}
.avatar-picker{display:grid;grid-template-columns:repeat(4,1fr);gap:clamp(6px,1vmin,12px);margin-bottom:1.5vh}
.avatar-option{font-size:clamp(1.5rem,4vmin,3rem);padding:clamp(6px,1.2vmin,15px);background:#333;border-radius:clamp(8px,1vmin,15px);cursor:pointer;transition:all .2s;border:clamp(2px,0.4vmin,4px) solid transparent}
.avatar-option:hover{transform:scale(1.1);background:#444}
.avatar-option.selected{border-color:#4CAF50;background:#2d5016}
.team-card input{width:100%;padding:clamp(8px,1.5vmin,15px);font-size:clamp(1rem,2.5vmin,1.5rem);border-radius:clamp(6px,1vmin,12px);border:none;text-align:center;background:#333;color:#fff;margin-top:1vh}
.game-settings{background:#1a1a1a;border-radius:clamp(10px,1.5vmin,20px);padding:clamp(15px,3vmin,30px);margin-bottom:2vh}
.game-settings h3{color:#FF9800;margin-bottom:2vh;font-size:clamp(1.1rem,2.8vmin,1.8rem)}
.setting-row{display:flex;justify-content:space-between;align-items:center;margin:clamp(8px,1.5vmin,15px) 0;padding:clamp(8px,1.5vmin,15px);background:#2a2a2a;border-radius:clamp(6px,1vmin,12px);flex-wrap:wrap;gap:10px}
.setting-row label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc}
.setting-row input,.setting-row select{padding:clamp(8px,1.5vmin,12px);font-size:clamp(0.95rem,2.2vmin,1.3rem);border-radius:clamp(5px,0.8vmin,10px);border:none;background:#333;color:#fff;width:clamp(100px,15vmin,150px);text-align:center}

/* Style picker */
.style-row{flex-direction:column;align-items:stretch;padding:0;background:transparent}
.style-selector{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(8px,1.5vmin,15px);
    background:#2a2a2a;
    border-radius:clamp(6px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.style-selector:hover{background:#333}
.style-selector label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc;pointer-events:none}
.style-current{display:flex;align-items:center;gap:10px}
.style-current span:first-child{color:#fff;font-size:clamp(0.95rem,2.2vmin,1.3rem)}
.style-arrow{color:#888;font-size:0.8rem;transition:transform .3s}
.style-row.open .style-arrow{transform:rotate(180deg)}
.style-picker{
    display:none;
    gap:clamp(8px,1.5vmin,15px);
    margin-top:clamp(8px,1.5vmin,12px);
    padding:clamp(10px,2vmin,15px);
    background:#222;
    border-radius:clamp(6px,1vmin,12px);
    flex-wrap:wrap;
    justify-content:center;
}
.style-row.open .style-picker{display:flex}
.style-option{
    cursor:pointer;
    padding:clamp(10px,1.5vmin,15px);
    border-radius:clamp(8px,1vmin,12px);
    border:2px solid transparent;
    background:#1a1a1a;
    transition:all .2s;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:clamp(6px,1vmin,10px);
}
.style-option:hover{border-color:#666;background:#252525}
.style-option.selected{border-color:#4CAF50;background:#1a2a1a}
.style-preview{
    display:flex;
    gap:clamp(4px,0.8vmin,8px);
    padding:clamp(6px,1vmin,12px);
    border-radius:clamp(6px,0.8vmin,10px);
    background:#111;
}
.preview-card{
    width:clamp(35px,6vmin,55px);
    height:clamp(45px,8vmin,70px);
    border-radius:clamp(4px,0.6vmin,8px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(0.5rem,1.2vmin,0.75rem);
    font-weight:bold;
    text-transform:uppercase;
    box-shadow:0 2px 4px rgba(0,0,0,0.3);
}
.deck-white .preview-card{background:#f5f5f5;color:#222}
.deck-classic .preview-card{background:#2a2a2a;color:#f0f0f0;border:1px solid #3a3a3a}
.deck-night .preview-card{background:linear-gradient(145deg,#1a1a2e,#0d0d18);color:#d0d0f0;border:1px solid #2a2a4e}
.preview-card.revealed.is-red{background:#e74c3c!important;color:#fff!important}
.preview-card.revealed.is-blue{background:#3498db!important;color:#fff!important}
.style-name{font-size:clamp(0.9rem,1.8vmin,1.1rem);color:#ccc}

/* Deck picker */
.deck-row{flex-direction:column;align-items:stretch;padding:0;background:transparent}
.deck-selector{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(8px,1.5vmin,15px);
    background:#2a2a2a;
    border-radius:clamp(6px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.deck-selector:hover{background:#333}
.deck-selector label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc;pointer-events:none}
.deck-current{display:flex;align-items:center;gap:10px}
.deck-current span:first-child{color:#fff;font-size:clamp(0.95rem,2.2vmin,1.3rem)}
.deck-arrow{color:#888;font-size:0.8rem;transition:transform .3s}
.deck-row.open .deck-arrow{transform:rotate(180deg)}
.deck-picker{
    display:none;
    flex-direction:column;
    gap:clamp(8px,1.5vmin,12px);
    margin-top:clamp(8px,1.5vmin,12px);
    padding:clamp(10px,2vmin,15px);
    background:#222;
    border-radius:clamp(6px,1vmin,12px);
}
.deck-row.open .deck-picker{display:flex}
.deck-option{
    cursor:pointer;
    padding:clamp(12px,2vmin,18px);
    border-radius:clamp(8px,1vmin,12px);
    border:2px solid transparent;
    background:#1a1a1a;
    transition:all .2s;
}
.deck-option:hover{border-color:#666;background:#252525}
.deck-option.selected{border-color:#4CAF50;background:#1a2a1a}
.deck-info{display:flex;flex-direction:column;gap:6px}
.deck-title{font-size:clamp(1rem,2vmin,1.3rem);color:#fff;font-weight:bold}
.deck-desc{font-size:clamp(0.8rem,1.6vmin,1rem);color:#888;line-height:1.4}

/* Rounds picker */
.rounds-row{flex-direction:column;align-items:stretch;padding:0;background:transparent}
.rounds-selector{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(8px,1.5vmin,15px);
    background:#2a2a2a;
    border-radius:clamp(6px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.rounds-selector:hover{background:#333}
.rounds-selector label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc;pointer-events:none}
.rounds-current{display:flex;align-items:center;gap:10px}
.rounds-current span:first-child{color:#fff;font-size:clamp(0.95rem,2.2vmin,1.3rem)}
.rounds-arrow{color:#888;font-size:0.8rem;transition:transform .3s}
.rounds-row.open .rounds-arrow{transform:rotate(180deg)}
.rounds-picker{
    display:none;
    flex-direction:column;
    gap:clamp(10px,1.5vmin,15px);
    margin-top:clamp(8px,1.5vmin,12px);
    padding:clamp(10px,2vmin,15px);
    background:#222;
    border-radius:clamp(6px,1vmin,12px);
}
.rounds-row.open .rounds-picker{display:flex}
.rounds-options{
    display:flex;
    gap:clamp(6px,1vmin,12px);
    flex-wrap:wrap;
    justify-content:center;
}
.rounds-option{
    width:clamp(40px,7vmin,60px);
    height:clamp(40px,7vmin,60px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(1.1rem,2.5vmin,1.6rem);
    font-weight:bold;
    color:#fff;
    background:#1a1a1a;
    border:2px solid transparent;
    border-radius:clamp(8px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.rounds-option:hover{border-color:#666;background:#252525}
.rounds-option.selected{border-color:#4CAF50;background:#1a2a1a}
.rounds-option.custom{font-size:clamp(1.5rem,3vmin,2rem);color:#888}
.rounds-custom{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:clamp(8px,1.5vmin,12px);
    padding-top:clamp(10px,1.5vmin,15px);
    border-top:1px solid #333;
}
.rounds-custom label{font-size:clamp(0.9rem,2vmin,1.1rem);color:#888}
.rounds-custom input{
    width:clamp(70px,12vmin,100px);
    padding:clamp(8px,1.5vmin,12px);
    font-size:clamp(1rem,2.2vmin,1.3rem);
    border-radius:clamp(5px,0.8vmin,10px);
    border:2px solid #4CAF50;
    background:#1a2a1a;
    color:#fff;
    text-align:center;
}

/* Generic picker */
.picker-row{flex-direction:column;align-items:stretch;padding:0;background:transparent}
.picker-selector{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:clamp(8px,1.5vmin,15px);
    background:#2a2a2a;
    border-radius:clamp(6px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.picker-selector:hover{background:#333}
.picker-selector label{font-size:clamp(1rem,2.5vmin,1.4rem);color:#ccc;pointer-events:none}
.picker-current{display:flex;align-items:center;gap:10px}
.picker-current span:first-child{color:#fff;font-size:clamp(0.95rem,2.2vmin,1.3rem)}
.picker-arrow{color:#888;font-size:0.8rem;transition:transform .3s}
.picker-row.open .picker-arrow{transform:rotate(180deg)}
.picker-panel{
    display:none;
    flex-direction:column;
    gap:clamp(10px,1.5vmin,15px);
    margin-top:clamp(8px,1.5vmin,12px);
    padding:clamp(10px,2vmin,15px);
    background:#222;
    border-radius:clamp(6px,1vmin,12px);
}
.picker-row.open .picker-panel{display:flex}
.picker-options{
    display:flex;
    gap:clamp(6px,1vmin,12px);
    flex-wrap:wrap;
    justify-content:center;
}
.picker-option{
    min-width:clamp(40px,7vmin,60px);
    height:clamp(40px,7vmin,60px);
    padding:0 clamp(10px,1.5vmin,15px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(1rem,2.2vmin,1.4rem);
    font-weight:bold;
    color:#fff;
    background:#1a1a1a;
    border:2px solid transparent;
    border-radius:clamp(8px,1vmin,12px);
    cursor:pointer;
    transition:all .2s;
}
.picker-option:hover{border-color:#666;background:#252525}
.picker-option.selected{border-color:#4CAF50;background:#1a2a1a}
.starter-options .picker-option{min-width:auto;padding:0 clamp(15px,2vmin,25px)}
.picker-info{
    text-align:center;
    font-size:clamp(0.9rem,2vmin,1.1rem);
    color:#888;
    padding-top:clamp(8px,1.5vmin,12px);
    border-top:1px solid #333;
}
.picker-info span{color:#4CAF50;font-weight:bold}
.button-group{display:flex;gap:clamp(10px,2vmin,20px);margin-top:2vh;flex-wrap:wrap}

button{padding:clamp(10px,2vh,20px) clamp(20px,3vw,40px);font-size:clamp(1rem,2.5vmin,1.5rem);border:none;border-radius:clamp(8px,1vmin,15px);font-weight:bold;cursor:pointer;transition:transform .2s}
button:hover{transform:scale(1.05)}button:active{transform:scale(.95)}
.btn-new{background:#4CAF50;color:#fff}
.btn-key{background:#FF9800;color:#fff}
.btn-reset{background:#e74c3c;color:#fff}

#endText{font-size:clamp(2rem,6vmin,5rem);margin-bottom:3vh}
.confetti{position:fixed;top:-20px;pointer-events:none;z-index:9999}

/* END OVERLAY */
.end-container{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:clamp(15px,3vmin,30px);
    padding:clamp(20px,4vmin,50px);
    max-width:min(600px,90vw);
}
.end-result{
    font-size:clamp(1.2rem,4vmin,2.5rem);
    font-weight:bold;
    text-align:center;
    padding:clamp(10px,2vmin,20px) clamp(20px,4vmin,40px);
    border-radius:clamp(10px,1.5vmin,20px);
    background:rgba(255,255,255,0.1);
}
.end-result.win-red{color:#e74c3c;border:2px solid #e74c3c}
.end-result.win-blue{color:#3498db;border:2px solid #3498db}
.end-result.assassin{color:#aaa;border:2px solid #1a1a1a;background:rgba(0,0,0,0.3)}
.end-result.match-won{
    font-size:clamp(1.5rem,5vmin,3rem);
    background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,215,0,0.05));
    border:2px solid gold;
    color:gold;
}
.end-scores{
    display:flex;
    align-items:center;
    gap:clamp(15px,3vmin,40px);
    margin:clamp(10px,2vmin,20px) 0;
}
.end-team{
    display:flex;
    align-items:center;
    gap:clamp(8px,1.5vmin,15px);
    padding:clamp(10px,2vmin,20px) clamp(15px,3vmin,30px);
    border-radius:clamp(10px,1.5vmin,20px);
    background:rgba(0,0,0,0.3);
}
.end-team.red{border:2px solid #e74c3c}
.end-team.blue{border:2px solid #3498db}
.end-emoji{font-size:clamp(1.5rem,4vmin,3rem)}
.end-name{font-size:clamp(0.9rem,2vmin,1.3rem);font-weight:bold}
.end-team.red .end-name{color:#e74c3c}
.end-team.blue .end-name{color:#3498db}
.end-score{
    font-size:clamp(2rem,6vmin,4rem);
    font-weight:bold;
    min-width:clamp(50px,8vmin,80px);
    text-align:center;
    padding:clamp(5px,1vmin,10px) clamp(10px,2vmin,20px);
    border-radius:clamp(8px,1vmin,15px);
}
.end-team.red .end-score{background:#e74c3c}
.end-team.blue .end-score{background:#3498db}
.end-vs{
    font-size:clamp(1.2rem,3vmin,2rem);
    font-weight:bold;
    color:#666;
}
.end-target{
    font-size:clamp(0.9rem,2vmin,1.2rem);
    color:#888;
}
.btn-next{
    font-size:clamp(1.1rem,3vmin,1.8rem)!important;
    padding:clamp(12px,2.5vmin,25px) clamp(30px,6vmin,60px)!important;
    margin-top:clamp(10px,2vmin,20px);
}
.btn-menu{
    margin-top:clamp(5px,1vmin,10px);
}

@media(max-width:500px){
.end-scores{flex-direction:column;gap:10px}
.end-team{width:100%;justify-content:space-between}
.end-vs{display:none}
}

/* MA≈ÅE EKRANY (telefony) */
@media(max-width:600px){
.top-bar{flex-wrap:wrap;padding:5px 10px;gap:5px}
.team-bar{max-width:100%;flex:1 1 45%;padding:8px 10px;gap:5px}
.team-bar .team-name{display:none}
.top-controls{order:-1;width:100%;justify-content:center;margin-bottom:5px}
.icon-btn{width:45px;height:45px}
.bottom-bar{flex-wrap:wrap;padding:5px;gap:5px}
.remaining-cards{max-width:42%}
.remaining-card{width:24px;height:32px}
.remaining-card .card-emoji{font-size:0.7rem}
.remaining-card .card-num{font-size:0.6rem}
#status{font-size:0.8rem;order:-1;width:100%;text-align:center;padding:3px 0}
}

/* TABLETY (iPad) */
@media(min-width:601px) and (max-width:1024px){
.remaining-card{width:clamp(26px,3.5vmin,45px);height:clamp(34px,4.5vmin,58px)}
.remaining-card .card-emoji{font-size:clamp(0.75rem,1.8vmin,1.3rem)}
.remaining-card .card-num{font-size:clamp(0.6rem,1.3vmin,1rem)}
.remaining-cards{gap:clamp(2px,0.3vmin,5px)}
}

/* BARDZO MA≈ÅE EKRANY */
@media(max-height:500px){
.top-bar{padding:3px 10px}
.team-bar{padding:5px 8px}
.bottom-bar{padding:3px 10px}
.remaining-card{width:22px;height:30px}
.remaining-card .card-emoji{font-size:0.65rem}
.remaining-card .card-num{font-size:0.55rem}
#status{font-size:0.75rem}
.board-container{padding:3px}
}

/* DU≈ªE EKRANY (TV) */
@media(min-width:1400px) and (min-height:900px){
.card{font-size:clamp(24px,4.5vmin,60px)}
.icon-btn{width:clamp(60px,7vmin,90px);height:clamp(60px,7vmin,90px);font-size:clamp(2rem,4vmin,3.5rem)}
}
</style>
</head>
<body>

<div class="overlay" id="homeScreen" style="display:flex">
<div class="home-container">
<h1 class="home-title">TAJNIACY</h1>
<p class="home-subtitle">Gra towarzyska</p>
<div class="mode-selection">
<div class="mode-card classic" onclick="selectMode('classic')">
<div class="mode-icon">üé≤</div>
<div class="mode-title">KLASYCZNA</div>
<div class="mode-description">Szybki start z tradycyjnymi zasadami</div>
<ul class="mode-features"><li>Standardowa plansza 5x5</li><li>1 zab√≥jca, 7 neutralnych</li><li>8/9 agent√≥w</li></ul>
</div>
<div class="mode-card crazy" onclick="selectMode('crazy')">
<div class="mode-icon">üé™</div>
<div class="mode-title">SZALONA</div>
<div class="mode-description">Wiƒôcej zab√≥jc√≥w, wiƒôcej emocji!</div>
<ul class="mode-features"><li>Od 1 do 7 zab√≥jc√≥w</li><li>Mniej neutralnych kart</li><li>Wybierz kto zaczyna</li></ul>
</div>
</div>
</div>
</div>

<div class="overlay" id="classicSettings">
<div class="settings-container">
<h2 class="settings-title">Tryb Klasyczny</h2>
<div class="team-setup">
<div class="team-card red">
<h3>Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="classicRedPicker"></div>
<input id="classicRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="classicBluePicker"></div>
<input id="classicBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<div class="setting-row deck-row">
<div class="deck-selector" id="classicDeckSelector" onclick="toggleDeckPicker('classic')">
<label>Talia kart:</label>
<div class="deck-current">
<span id="classicDeckName">Standardowa</span>
<span class="deck-arrow">‚ñº</span>
</div>
</div>
<div class="deck-picker" id="classicDeckPicker">
<div class="deck-option selected" data-deck="standard">
<div class="deck-info">
<span class="deck-title">Standardowa</span>
<span class="deck-desc">Klasyczne s≈Çowa dla ca≈Çej rodziny. Bezpieczne has≈Ça odpowiednie dla ka≈ºdego wieku.</span>
</div>
</div>
<div class="deck-option" data-deck="adult">
<div class="deck-info">
<span class="deck-title">Dla doros≈Çych (18+)</span>
<span class="deck-desc">Has≈Ça z motywami dla doros≈Çych: alkohol, imprezy, kasyno i wiƒôcej.</span>
</div>
</div>
</div>
<input type="hidden" id="classicDeck" value="standard">
</div>
<div class="setting-row style-row">
<div class="style-selector" id="classicStyleSelector" onclick="toggleStylePicker('classic')">
<label>Styl kart:</label>
<div class="style-current">
<span id="classicStyleName">Bia≈Çe</span>
<span class="style-arrow">‚ñº</span>
</div>
</div>
<div class="style-picker" id="classicStylePicker">
<div class="style-option selected" data-style="white">
<div class="style-preview deck-white">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Bia≈Çe</span>
</div>
<div class="style-option" data-style="classic">
<div class="style-preview deck-classic">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Ciemne</span>
</div>
<div class="style-option" data-style="night">
<div class="style-preview deck-night">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Noc</span>
</div>
</div>
<input type="hidden" id="classicStyle" value="white">
</div>
<div class="setting-row rounds-row">
<div class="rounds-selector" id="classicRoundsSelector" onclick="toggleRoundsPicker('classic')">
<label>Rundy do wygranej:</label>
<div class="rounds-current">
<span id="classicRoundsName">3</span>
<span class="rounds-arrow">‚ñº</span>
</div>
</div>
<div class="rounds-picker" id="classicRoundsPicker">
<div class="rounds-options">
<div class="rounds-option" data-rounds="1">1</div>
<div class="rounds-option" data-rounds="2">2</div>
<div class="rounds-option selected" data-rounds="3">3</div>
<div class="rounds-option" data-rounds="4">4</div>
<div class="rounds-option" data-rounds="5">5</div>
<div class="rounds-option custom" data-rounds="custom">...</div>
</div>
<div class="rounds-custom" id="classicRoundsCustom" style="display:none">
<label>W≈Çasna liczba:</label>
<input type="number" id="classicRoundsInput" min="1" max="99" value="6" onchange="updateCustomRounds('classic')">
</div>
</div>
<input type="hidden" id="classicWinTarget" value="3">
</div>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startClassic()" style="flex:2;font-size:1.3rem">Start</button>
</div>
</div>
</div>

<div class="overlay" id="crazySettings">
<div class="settings-container">
<h2 class="settings-title">Tryb Szalony</h2>
<div class="team-setup">
<div class="team-card red">
<h3>Dru≈ºyna Czerwona</h3>
<div class="avatar-picker" id="crazyRedPicker"></div>
<input id="crazyRedName" value="Czerwoni" placeholder="Nazwa dru≈ºyny">
</div>
<div class="team-card blue">
<h3>Dru≈ºyna Niebieska</h3>
<div class="avatar-picker" id="crazyBluePicker"></div>
<input id="crazyBlueName" value="Niebiescy" placeholder="Nazwa dru≈ºyny">
</div>
</div>
<div class="game-settings">
<h3 style="color:#FF9800;margin-bottom:15px">Zaawansowane</h3>
<div class="setting-row deck-row">
<div class="deck-selector" id="crazyDeckSelector" onclick="toggleDeckPicker('crazy')">
<label>Talia kart:</label>
<div class="deck-current">
<span id="crazyDeckName">Standardowa</span>
<span class="deck-arrow">‚ñº</span>
</div>
</div>
<div class="deck-picker" id="crazyDeckPicker">
<div class="deck-option selected" data-deck="standard">
<div class="deck-info">
<span class="deck-title">Standardowa</span>
<span class="deck-desc">Klasyczne s≈Çowa dla ca≈Çej rodziny. Bezpieczne has≈Ça odpowiednie dla ka≈ºdego wieku.</span>
</div>
</div>
<div class="deck-option" data-deck="adult">
<div class="deck-info">
<span class="deck-title">Dla doros≈Çych (18+)</span>
<span class="deck-desc">Has≈Ça z motywami dla doros≈Çych: alkohol, imprezy, kasyno i wiƒôcej.</span>
</div>
</div>
</div>
<input type="hidden" id="crazyDeck" value="standard">
</div>
<div class="setting-row style-row">
<div class="style-selector" id="crazyStyleSelector" onclick="toggleStylePicker('crazy')">
<label>Styl kart:</label>
<div class="style-current">
<span id="crazyStyleName">Bia≈Çe</span>
<span class="style-arrow">‚ñº</span>
</div>
</div>
<div class="style-picker" id="crazyStylePicker">
<div class="style-option selected" data-style="white">
<div class="style-preview deck-white">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Bia≈Çe</span>
</div>
<div class="style-option" data-style="classic">
<div class="style-preview deck-classic">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Ciemne</span>
</div>
<div class="style-option" data-style="night">
<div class="style-preview deck-night">
<div class="preview-card">Agent</div>
<div class="preview-card revealed is-red">Red</div>
<div class="preview-card revealed is-blue">Blue</div>
</div>
<span class="style-name">Noc</span>
</div>
</div>
<input type="hidden" id="crazyStyle" value="white">
</div>
<div class="setting-row picker-row">
<div class="picker-selector" id="crazyAssassinsSelector" onclick="togglePicker('crazyAssassins')">
<label>Zab√≥jcy:</label>
<div class="picker-current">
<span id="crazyAssassinsName">1</span>
<span class="picker-arrow">‚ñº</span>
</div>
</div>
<div class="picker-panel" id="crazyAssassinsPanel">
<div class="picker-options">
<div class="picker-option selected" data-value="1">1</div>
<div class="picker-option" data-value="2">2</div>
<div class="picker-option" data-value="3">3</div>
<div class="picker-option" data-value="4">4</div>
<div class="picker-option" data-value="5">5</div>
<div class="picker-option" data-value="6">6</div>
<div class="picker-option" data-value="7">7</div>
</div>
<div class="picker-info">Neutralne: <span id="crazyNeutralDisplay">7</span></div>
</div>
<input type="hidden" id="crazyAssassins" value="1">
<input type="hidden" id="crazyNeutral" value="7">
</div>
<div class="setting-row picker-row">
<div class="picker-selector" id="crazyStarterSelector" onclick="togglePicker('crazyStarter')">
<label>Zaczyna:</label>
<div class="picker-current">
<span id="crazyStarterName">Losowo</span>
<span class="picker-arrow">‚ñº</span>
</div>
</div>
<div class="picker-panel" id="crazyStarterPanel">
<div class="picker-options starter-options">
<div class="picker-option selected" data-value="random">üé≤ Losowo</div>
<div class="picker-option" data-value="red">üî¥ Czerwoni</div>
<div class="picker-option" data-value="blue">üîµ Niebiescy</div>
</div>
</div>
<input type="hidden" id="crazyStarter" value="random">
</div>
<div class="setting-row rounds-row">
<div class="rounds-selector" id="crazyRoundsSelector" onclick="toggleRoundsPicker('crazy')">
<label>Rundy do wygranej:</label>
<div class="rounds-current">
<span id="crazyRoundsName">3</span>
<span class="rounds-arrow">‚ñº</span>
</div>
</div>
<div class="rounds-picker" id="crazyRoundsPicker">
<div class="rounds-options">
<div class="rounds-option" data-rounds="1">1</div>
<div class="rounds-option" data-rounds="2">2</div>
<div class="rounds-option selected" data-rounds="3">3</div>
<div class="rounds-option" data-rounds="4">4</div>
<div class="rounds-option" data-rounds="5">5</div>
<div class="rounds-option custom" data-rounds="custom">...</div>
</div>
<div class="rounds-custom" id="crazyRoundsCustom" style="display:none">
<label>W≈Çasna liczba:</label>
<input type="number" id="crazyRoundsInput" min="1" max="99" value="6" onchange="updateCustomRounds('crazy')">
</div>
</div>
<input type="hidden" id="crazyWinTarget" value="3">
</div>
</div>
<div class="button-group">
<button class="btn-reset" onclick="backToHome()" style="flex:1">‚Üê Powr√≥t</button>
<button class="btn-new" onclick="startCrazy()" style="flex:2;font-size:1.3rem">Start</button>
</div>
</div>
</div>

<div id="gameScreen">
<div class="top-bar">
<div class="team-bar red">
<span class="team-emoji" id="scoreRedEmoji">üêâ</span>
<span class="team-name" id="scoreRedName">Czerwoni</span>
<span class="team-score" id="scoreRedPoints">0</span>
</div>
<div class="top-controls">
<button class="icon-btn" id="newRoundBtn" title="Nowa runda (przytrzymaj)"><svg class="hold-progress" viewBox="0 0 100 100"><path d="M50 2 L85 2 Q98 2 98 15 L98 85 Q98 98 85 98 L15 98 Q2 98 2 85 L2 15 Q2 2 15 2 Z"/></svg><span>üîÑ</span></button>
<button class="icon-btn" id="keyBtn" title="Poka≈º klucz (przytrzymaj)"><svg class="hold-progress" viewBox="0 0 100 100"><path d="M50 2 L85 2 Q98 2 98 15 L98 85 Q98 98 85 98 L15 98 Q2 98 2 85 L2 15 Q2 2 15 2 Z"/></svg><span>üëÅÔ∏è</span></button>
<button class="icon-btn settings-btn" onclick="showO('gameSettings')" title="Ustawienia"><span>‚öôÔ∏è</span></button>
</div>
<div class="team-bar blue">
<span class="team-score" id="scoreBluePoints">0</span>
<span class="team-name" id="scoreBlueName">Niebiescy</span>
<span class="team-emoji" id="scoreBlueEmoji">ü¶à</span>
</div>
</div>
<div class="board-container">
<div class="grid-container" id="board"></div>
</div>
<div class="bottom-bar">
<div class="remaining-cards red" id="redPanel"></div>
<div id="status">ZaczynajƒÖ: ...</div>
<div class="remaining-cards blue" id="bluePanel"></div>
</div>
</div>

<div class="overlay" id="gameSettings">
<div class="settings-container" style="max-width:400px">
<h2 style="font-size:1.8rem;margin-bottom:20px">Ustawienia</h2>
<div style="display:flex;flex-direction:column;gap:15px">
<div class="setting-row" style="margin:0">
<label>D≈∫wiƒôki:</label>
<select id="gameSoundToggle" onchange="cfg.sound=this.value==='true'">
<option value="true">W≈ÇƒÖczone</option>
<option value="false">Wy≈ÇƒÖczone</option>
</select>
</div>
<button class="btn-new" onclick="hideO('gameSettings')" style="width:100%">Kontynuuj grƒô</button>
<button class="btn-reset" onclick="hideO('gameSettings');confirmBack()" style="width:100%;padding:15px">Powr√≥t do menu</button>
</div>
</div>
</div>

<div class="overlay" id="endOverlay">
<div class="end-container">
<div class="end-result" id="endResult"></div>
<div class="end-scores">
<div class="end-team red">
<span class="end-emoji" id="endRedEmoji">üêâ</span>
<span class="end-name" id="endRedName">Czerwoni</span>
<span class="end-score" id="endRedScore">0</span>
</div>
<div class="end-vs">VS</div>
<div class="end-team blue">
<span class="end-score" id="endBlueScore">0</span>
<span class="end-name" id="endBlueName">Niebiescy</span>
<span class="end-emoji" id="endBlueEmoji">ü¶à</span>
</div>
</div>
<div class="end-target" id="endTarget">Pierwszy do 3 wygranych</div>
<button class="btn-new btn-next" id="nextRoundBtn" onclick="hideO('endOverlay');initRound()">Kolejna runda ‚Üí</button>
<button class="btn-reset btn-menu" id="matchWonBtn" onclick="resetMatch()" style="display:none">Powr√≥t do menu</button>
</div>
</div>

<div class="overlay" id="assassinOverlay">
<h2>ZAB√ìJCA!</h2>
<p style="font-size:1.2rem;margin:20px 0">Kt√≥ra dru≈ºyna trafi≈Ça na zab√≥jcƒô?</p>
<button class="btn-new" style="background:#e74c3c;margin:10px" onclick="assassinHit('red')"><span id="assRedText">Czerwoni</span></button>
<button class="btn-new" style="background:#3498db;margin:10px" onclick="assassinHit('blue')"><span id="assBlueText">Niebiescy</span></button>
</div>

<div class="overlay" id="keyWarning">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">Poka≈º klucz?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">Uwaga! To ujawni wszystkie karty.</p>
<p style="font-size:1rem;color:#ccc;margin-bottom:30px">Upewnij siƒô, ≈ºe tylko szpiedzy widzƒÖ ekran!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('keyWarning')">Anuluj</button>
<button class="btn-key" onclick="showKey()">Poka≈º</button>
</div>
</div>
</div>

<div class="overlay" id="newRoundConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">Nowa runda?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">Obecna rozgrywka zostanie zresetowana.</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('newRoundConfirm')">Anuluj</button>
<button class="btn-new" onclick="hideO('newRoundConfirm');initRound()">Nowa runda</button>
</div>
</div>
</div>

<div class="overlay" id="backConfirm">
<div class="settings-container" style="max-width:500px">
<h2 style="font-size:2rem;margin-bottom:20px">Powr√≥t do menu?</h2>
<p style="font-size:1.2rem;color:#f39c12;margin-bottom:30px">Ca≈Çy postƒôp meczu zostanie utracony!</p>
<div style="display:flex;gap:15px;justify-content:center">
<button class="btn-reset" onclick="hideO('backConfirm')">Anuluj</button>
<button class="btn-key" style="background:#e74c3c" onclick="resetMatch()">Menu</button>
</div>
</div>
</div>

<script>
const WORDS=["Dinozaur","L√≥d","Szpieg","Zamek","Ksiƒô≈ºyc","Pies","D≈∫wig","Afryka","Piramida","Pilot","Szpital","Oko","Nied≈∫wied≈∫","Orze≈Ç","Trawa","Bombowiec","PociƒÖg","Doktor","Ziemia","Wieloryb","Szko≈Ça","G√≥ra","But","Bank","Ryba","Anio≈Ç","PajƒÖk","Klucz","Z≈Çoto","Papier","Jab≈Çko","Ogie≈Ñ","Samolot","Kod","Mecz","Tort","Gwiazda","Policja","Woda","Mur","Kr√≥lowa","Rycerz","Wiatr","Radio","Las","Duch","Zegarek","Rzeka","Komputer","KsiƒÖ≈ºka","Kawa","Cukier","Miasto","Most","Grom","S≈Ço≈Ñce","Chmura","≈önieg","Deszcz","Burza","Sztorm","Ocean","Pla≈ºa","Wyspa","D≈ºungla","Pustynia","Lawina","Wulkan","Trzƒôsienie","Robot","Laser","Rakieta","Planeta","Kometa","Satelita","Astronauta","Mars","Gitara","Pianino","Bƒôben","TrƒÖbka","Skrzypce","Opera","Koncert","Muzyka","Malarz","Rze≈∫ba","Galeria","Obraz","Farba","Pƒôdzel","Paleta","Muzeum","Pi≈Çka","Stadion","Bramka","Sƒôdzia","Mistrz","Medal","Puchar","Olimpiada","Smok","Czarodziej","Elf","Krasnolud","Troll","Goblin","Mag","Kapitan","Statek","Kotwica","≈ªagiel","Pirat","Skarb","Mapa","Kompas","Telefon","Ekran","Mysz","Klawiatura","Monitor","Drukarka","Kamera","Mikrofon"];
const ADULT=["Kamasutra","Orgazm","Seks","Erotyka","Striptiz","Kochanek","Gangster","Mafioso","Grzech","Piek≈Ço","Szatan","Demon","Alkohol","W√≥dka","Narkotyk","Dealer","Przemyt","Zab√≥jca","Morderca","Trucizna","Bro≈Ñ","Rewolwer","Karabin","Granat","Dynamit","Poker","Kasyno","Hazard","Ruletka","Oszust","Kanciarz","Wiƒôzienie","Kraty","Kajdanki","Policjant","Areszt","Cela","Wyrok","Whisky","Piwo","Wino","Kac","Impreza","Disco","Klub","Jackpot","Stawka","Blef","Hip-Hop","Rap","Skandal"];
const EMOJIS_RED=["üêâ","ü¶Å","üî•","üå∂Ô∏è","ü¶Ö","üöÄ","‚ö°","üíé"];
const EMOJIS_BLUE=["ü¶à","üê∫","‚ùÑÔ∏è","üåä","ü¶ã","üõ∏","‚≠ê","üîÆ"];

let wordList=WORDS,gameMode='classic',gameOver=false,isSpymaster=false,sideCards={red:[],blue:[]};
const team={red:{name:"Czerwoni",emoji:"üêâ",score:0},blue:{name:"Niebiescy",emoji:"ü¶à",score:0}};
const cfg={winTarget:3,sound:true,assassins:1,starter:'random',startAgents:9,otherAgents:8,neutral:7,width:5,height:5,deckStyle:'white'};
let remaining={red:0,blue:0};

const $=id=>document.getElementById(id);
const showO=id=>$(id).style.display='flex';
const hideO=id=>$(id).style.display='none';
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

function toggleStylePicker(mode){
    const row=$(mode+'StyleSelector').closest('.style-row');
    row.classList.toggle('open');
}

function toggleDeckPicker(mode){
    const row=$(mode+'DeckSelector').closest('.deck-row');
    row.classList.toggle('open');
}

function toggleRoundsPicker(mode){
    const row=$(mode+'RoundsSelector').closest('.rounds-row');
    row.classList.toggle('open');
}

function togglePicker(id){
    const row=$(id+'Selector').closest('.picker-row');
    row.classList.toggle('open');
}

function updateCustomRounds(mode){
    const input=$(mode+'RoundsInput');
    const value=Math.max(1,Math.min(99,parseInt(input.value)||1));
    input.value=value;
    $(mode+'WinTarget').value=value;
    $(mode+'RoundsName').textContent=value;
}

function buildPickers(){
    ['classic','crazy'].forEach(mode=>{
        [['Red',EMOJIS_RED,'red'],['Blue',EMOJIS_BLUE,'blue']].forEach(([suffix,emojis,t])=>{
            const picker=$(mode+suffix+'Picker');
            if(!picker)return;
            picker.innerHTML='';
            emojis.forEach((e,i)=>{
                const div=document.createElement('div');
                div.className='avatar-option'+(i===0?' selected':'');
                div.dataset.emoji=e;
                div.textContent=e;
                div.onclick=()=>{
                    picker.querySelectorAll('.avatar-option').forEach(o=>o.classList.remove('selected'));
                    div.classList.add('selected');
                    team[t].emoji=e;
                };
                picker.appendChild(div);
            });
        });
        
        // Style picker
        const stylePicker=$(mode+'StylePicker');
        const styleNameEl=$(mode+'StyleName');
        if(stylePicker){
            stylePicker.querySelectorAll('.style-option').forEach(opt=>{
                opt.onclick=()=>{
                    stylePicker.querySelectorAll('.style-option').forEach(o=>o.classList.remove('selected'));
                    opt.classList.add('selected');
                    $(mode+'Style').value=opt.dataset.style;
                    styleNameEl.textContent=opt.querySelector('.style-name').textContent;
                    $(mode+'StyleSelector').closest('.style-row').classList.remove('open');
                };
            });
        }
        
        // Deck picker
        const deckPicker=$(mode+'DeckPicker');
        const deckNameEl=$(mode+'DeckName');
        if(deckPicker){
            deckPicker.querySelectorAll('.deck-option').forEach(opt=>{
                opt.onclick=()=>{
                    deckPicker.querySelectorAll('.deck-option').forEach(o=>o.classList.remove('selected'));
                    opt.classList.add('selected');
                    $(mode+'Deck').value=opt.dataset.deck;
                    deckNameEl.textContent=opt.querySelector('.deck-title').textContent;
                };
            });
        }
        
        // Rounds picker
        const roundsPicker=$(mode+'RoundsPicker');
        const roundsNameEl=$(mode+'RoundsName');
        const customEl=$(mode+'RoundsCustom');
        if(roundsPicker){
            roundsPicker.querySelectorAll('.rounds-option').forEach(opt=>{
                opt.onclick=()=>{
                    roundsPicker.querySelectorAll('.rounds-option').forEach(o=>o.classList.remove('selected'));
                    opt.classList.add('selected');
                    
                    if(opt.dataset.rounds==='custom'){
                        customEl.style.display='flex';
                        updateCustomRounds(mode);
                    }else{
                        customEl.style.display='none';
                        $(mode+'WinTarget').value=opt.dataset.rounds;
                        roundsNameEl.textContent=opt.dataset.rounds;
                    }
                };
            });
        }
    });
    
    // Assassins picker (tylko crazy)
    const assassinsPanel=$('crazyAssassinsPanel');
    if(assassinsPanel){
        assassinsPanel.querySelectorAll('.picker-option').forEach(opt=>{
            opt.onclick=()=>{
                assassinsPanel.querySelectorAll('.picker-option').forEach(o=>o.classList.remove('selected'));
                opt.classList.add('selected');
                const val=parseInt(opt.dataset.value);
                $('crazyAssassins').value=val;
                $('crazyAssassinsName').textContent=val;
                const neutral=8-val;
                $('crazyNeutral').value=neutral;
                $('crazyNeutralDisplay').textContent=neutral;
            };
        });
    }
    
    // Starter picker (tylko crazy)
    const starterPanel=$('crazyStarterPanel');
    if(starterPanel){
        starterPanel.querySelectorAll('.picker-option').forEach(opt=>{
            opt.onclick=()=>{
                starterPanel.querySelectorAll('.picker-option').forEach(o=>o.classList.remove('selected'));
                opt.classList.add('selected');
                $('crazyStarter').value=opt.dataset.value;
                $('crazyStarterName').textContent=opt.textContent.trim();
            };
        });
    }
}

function selectMode(mode){
    gameMode=mode;
    hideO('homeScreen');
    showO(mode==='classic'?'classicSettings':'crazySettings');
}

function backToHome(){hideO('classicSettings');hideO('crazySettings');showO('homeScreen')}

function startClassic(){
    team.red.name=$('classicRedName').value||'Czerwoni';
    team.blue.name=$('classicBlueName').value||'Niebiescy';
    cfg.winTarget=Math.max(1,+$('classicWinTarget').value||3);
    cfg.deckStyle=$('classicStyle').value;
    wordList=$('classicDeck').value==='adult'?ADULT:WORDS;
    cfg.assassins=1;cfg.starter='random';cfg.startAgents=9;cfg.otherAgents=8;cfg.neutral=7;cfg.width=5;cfg.height=5;
    team.red.score=team.blue.score=0;
    hideO('classicSettings');
    $('gameScreen').style.display='flex';
    $('board').className='grid-container deck-'+cfg.deckStyle;
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function startCrazy(){
    team.red.name=$('crazyRedName').value||'Czerwoni';
    team.blue.name=$('crazyBlueName').value||'Niebiescy';
    wordList=$('crazyDeck').value==='adult'?ADULT:WORDS;
    cfg.deckStyle=$('crazyStyle').value;
    cfg.assassins=Math.max(1,Math.min(7,+$('crazyAssassins').value||1));
    cfg.starter=$('crazyStarter').value;
    cfg.startAgents=9;
    cfg.otherAgents=8;
    cfg.neutral=8-cfg.assassins;
    cfg.width=5;
    cfg.height=5;
    cfg.winTarget=Math.max(1,+$('crazyWinTarget').value||3);
    team.red.score=team.blue.score=0;
    hideO('crazySettings');
    $('gameScreen').style.display='flex';
    $('board').className='grid-container deck-'+cfg.deckStyle;
    document.body.classList.add('game-active');
    updateScore();initRound();
}

function updateScore(){
    $('scoreRedEmoji').textContent=team.red.emoji;$('scoreRedName').textContent=team.red.name;$('scoreRedPoints').textContent=team.red.score;
    $('scoreBlueEmoji').textContent=team.blue.emoji;$('scoreBlueName').textContent=team.blue.name;$('scoreBluePoints').textContent=team.blue.score;
}

function createSideCards(){
    ['red','blue'].forEach(c=>{
        const panel=$(c+'Panel');
        panel.innerHTML='';
        sideCards[c]=[];
        for(let i=0;i<remaining[c];i++){
            const card=document.createElement('div');
            card.className='remaining-card';
            card.innerHTML=`<span class="card-emoji">${team[c].emoji}</span><span class="card-num">${i+1}</span>`;
            card.style.opacity='0';
            card.style.transform='scale(0)';
            panel.appendChild(card);
            sideCards[c].push(card);
        }
        // Animacja pojawiania siƒô ≈ºeton√≥w
        setTimeout(()=>animateTokensAppear(sideCards[c]),100);
    });
}

function updateSideCard(c){
    const unrevealed=sideCards[c].filter(e=>!e.classList.contains('revealed'));
    if(unrevealed.length){
        const token=unrevealed[unrevealed.length-1];
        token.classList.add('revealed');
        animateTokenReveal(token);
    }
}

function genLayout(roles,w,h){
    let attempts=0,result;
    do{result=shuffle([...roles]);attempts++}while(!checkLayout(result,w,h)&&attempts<50);
    return result;
}

function checkLayout(r,w,h){
    for(let row=0;row<h;row++)for(let col=0;col<=w-3;col++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+1]&&r[i+1]===r[i+2])return false}
    for(let col=0;col<w;col++)for(let row=0;row<=h-3;row++){const i=row*w+col;if(r[i]!=='neutral'&&r[i]===r[i+w]&&r[i+w]===r[i+2*w])return false}
    return true;
}

function initRound(){
    const board=$('board'),status=$('status');
    board.innerHTML='';hideO('endOverlay');
    gameOver=false;isSpymaster=false;
    document.body.classList.remove('spymaster-mode');
    $('keyBtn').querySelector('span').textContent='üëÅÔ∏è';
    $('keyBtn').classList.remove('active');
    
    const redStarts=cfg.starter==='random'?Math.random()<.5:cfg.starter==='red';
    remaining={red:redStarts?cfg.startAgents:cfg.otherAgents,blue:redStarts?cfg.otherAgents:cfg.startAgents};
    createSideCards();
    
    status.innerHTML=`ZaczynajƒÖ: <span class="team-${redStarts?'red':'blue'}">${team[redStarts?'red':'blue'].emoji} ${team[redStarts?'red':'blue'].name}</span>`;
    
    let roles=[...Array(cfg.assassins).fill('assassin'),...Array(cfg.neutral).fill('neutral'),...Array(remaining.red).fill('red'),...Array(remaining.blue).fill('blue')];
    roles=genLayout(roles,cfg.width,cfg.height);
    
    const words=shuffle([...wordList]).slice(0,cfg.width*cfg.height);
    
    words.forEach((word,i)=>{
        if(i>=roles.length)return;
        const card=document.createElement('div');
        card.className=`card is-${roles[i]}`;
        card.textContent=word;
        card.style.opacity='0';
        card.onclick=()=>{
            if(gameOver||isSpymaster||card.classList.contains('revealed'))return;
            card.classList.add('revealed');
            animateCardReveal(card);
            playSound('click');
            if(roles[i]==='assassin'){
                gameOver=true;
                $('assRedText').textContent=team.red.name;
                $('assBlueText').textContent=team.blue.name;
                showO('assassinOverlay');
                return;
            }
            if(roles[i]==='red'){remaining.red--;updateSideCard('red');if(!remaining.red)endRound(null,'red')}
            if(roles[i]==='blue'){remaining.blue--;updateSideCard('blue');if(!remaining.blue)endRound(null,'blue')}
        };
        board.appendChild(card);
    });
    
    // Animacja pojawiania siƒô kart
    setTimeout(()=>animateCardAppear(board.querySelectorAll('.card')),50);
}

function endRound(resultText,winner,isAssassin=false){
    gameOver=true;
    
    // Aktualizuj dane dru≈ºyn w overlay
    $('endRedEmoji').textContent=team.red.emoji;
    $('endRedName').textContent=team.red.name;
    $('endBlueEmoji').textContent=team.blue.emoji;
    $('endBlueName').textContent=team.blue.name;
    
    const resultEl=$('endResult');
    resultEl.className='end-result';
    
    if(winner){
        team[winner].score++;
        updateScore();
        
        // Animacja wyniku w g√≥rnym pasku
        animateScoreUpdate($('score'+winner.charAt(0).toUpperCase()+winner.slice(1)+'Points'));
        
        $('endRedScore').textContent=team.red.score;
        $('endBlueScore').textContent=team.blue.score;
        $('endTarget').textContent=`Do ${cfg.winTarget} wygranych rund`;
        
        if(team[winner].score>=cfg.winTarget){
            // Wygrana meczu
            confetti(winner==='red'?'#e74c3c':'#3498db');
            playSound('win');
            resultEl.textContent=`${team[winner].emoji} ${team[winner].name} WYGRYWAJƒÑ MECZ!`;
            resultEl.classList.add('match-won');
            $('nextRoundBtn').style.display='none';
            $('matchWonBtn').style.display='inline-block';
        }else{
            // Wygrana rundy
            playSound('win');
            if(isAssassin){
                resultEl.textContent=resultText;
                resultEl.classList.add('assassin');
            }else{
                resultEl.textContent=`${team[winner].emoji} ${team[winner].name} wygrywajƒÖ rundƒô!`;
                resultEl.classList.add('win-'+winner);
            }
            $('nextRoundBtn').style.display='inline-block';
            $('matchWonBtn').style.display='none';
        }
    }
    
    showO('endOverlay');
}

function assassinHit(loser){
    hideO('assassinOverlay');
    const winner=loser==='red'?'blue':'red';
    endRound(`${team[loser].emoji} ${team[loser].name} trafili na zab√≥jcƒô!`,winner,true);
}

function toggleKey(){
    if(gameOver)return;
    if(!isSpymaster)showO('keyWarning');
    else{isSpymaster=false;document.body.classList.remove('spymaster-mode');$('keyBtn').querySelector('span').textContent='üëÅÔ∏è';$('keyBtn').classList.remove('active')}
}

function showKey(){
    hideO('keyWarning');
    isSpymaster=true;
    document.body.classList.add('spymaster-mode');
    $('keyBtn').querySelector('span').textContent='üëÅÔ∏è';
    $('keyBtn').classList.add('active');
}

function confirmNewRound(){
    hideO('gameSettings');
    if(!gameOver&&$('board').children.length)showO('newRoundConfirm');
    else initRound();
}

function confirmBack(){showO('backConfirm')}

function resetMatch(){
    hideO('backConfirm');hideO('endOverlay');hideO('gameSettings');
    $('gameScreen').style.display='none';
    showO('homeScreen');
    document.body.classList.remove('game-active','spymaster-mode');
    $('board').innerHTML='';
    $('redPanel').innerHTML='';
    $('bluePanel').innerHTML='';
    team.red.score=team.blue.score=0;
    gameOver=false;isSpymaster=false;
}

function confetti(color){
    const colors = color === '#e74c3c' ? ['#e74c3c','#c0392b','#ff6b6b','#ee5a24'] : ['#3498db','#2980b9','#74b9ff','#0984e3'];
    for(let i=0;i<80;i++){
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left=Math.random()*100+'vw';
        c.style.background=colors[Math.floor(Math.random()*colors.length)];
        c.style.width=(8+Math.random()*10)+'px';
        c.style.height=(8+Math.random()*10)+'px';
        c.style.borderRadius=Math.random()>0.5?'50%':'0';
        document.body.appendChild(c);
        
        anime({
            targets:c,
            translateY:[0,window.innerHeight+100],
            translateX:()=>anime.random(-100,100),
            rotate:()=>anime.random(0,720),
            scale:[1,anime.random(0.5,1.5)],
            opacity:[1,0],
            duration:anime.random(2000,4000),
            easing:'easeOutQuad',
            complete:()=>c.remove()
        });
    }
}

// Animacje Anime.js
function animateCardReveal(card){
    anime({
        targets:card,
        scale:[1,1.1,1],
        rotateY:[0,10,0],
        duration:400,
        easing:'easeOutBack'
    });
}

function animateCardAppear(cards){
    anime({
        targets:cards,
        scale:[0.8,1],
        opacity:[0,1],
        delay:anime.stagger(30,{grid:[5,5],from:'center'}),
        duration:400,
        easing:'easeOutBack'
    });
}

function animateTokenReveal(token){
    anime({
        targets:token,
        scale:[1,0.85],
        opacity:[1,0.2],
        duration:300,
        easing:'easeOutQuad'
    });
}

function animateTokensAppear(tokens){
    anime({
        targets:tokens,
        scale:[0,1],
        opacity:[0,1],
        delay:anime.stagger(50),
        duration:300,
        easing:'easeOutBack'
    });
}

function animateOverlayShow(overlay){
    const container=overlay.querySelector('.settings-container, .home-container, #endText');
    anime.set(overlay,{display:'flex'});
    anime({
        targets:overlay,
        opacity:[0,1],
        duration:200,
        easing:'easeOutQuad'
    });
    if(container){
        anime({
            targets:container,
            scale:[0.9,1],
            opacity:[0,1],
            duration:300,
            easing:'easeOutBack'
        });
    }
}

function animateOverlayHide(overlay,callback){
    anime({
        targets:overlay,
        opacity:[1,0],
        duration:200,
        easing:'easeInQuad',
        complete:()=>{
            overlay.style.display='none';
            if(callback)callback();
        }
    });
}

function animateScoreUpdate(el){
    anime({
        targets:el,
        scale:[1,1.3,1],
        duration:400,
        easing:'easeOutBack'
    });
}

function animateButtonHover(btn,enter){
    anime.remove(btn);
    anime({
        targets:btn,
        scale:enter?1.1:1,
        duration:200,
        easing:'easeOutQuad'
    });
}

function animateHoldProgress(btn,progress){
    const circle=btn.querySelector('.hold-progress');
    if(circle){
        circle.style.background=`conic-gradient(#4CAF50 ${progress*360}deg, transparent ${progress*360}deg)`;
    }
}

let audioCtx=null;
function playSound(type){
    if(!cfg.sound)return;
    try{
        if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
        const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
        osc.connect(gain);gain.connect(audioCtx.destination);
        if(type==='assassin'){osc.frequency.value=100;gain.gain.setValueAtTime(.3,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.5);osc.start();osc.stop(audioCtx.currentTime+.5)}
        else if(type==='win'){[523,659,784].forEach((f,i)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=f;g.gain.setValueAtTime(.2,audioCtx.currentTime+i*.15);g.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+i*.15+.3);o.start(audioCtx.currentTime+i*.15);o.stop(audioCtx.currentTime+i*.15+.3)})}
        else{osc.frequency.value=800;gain.gain.setValueAtTime(.15,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+.1);osc.start();osc.stop(audioCtx.currentTime+.1)}
    }catch(e){}
}

buildPickers();
showO('homeScreen');

// Obs≈Çuga przytrzymania przycisk√≥w z animacjƒÖ
let holdTimer=null;
let holdAnimation=null;
const HOLD_TIME=500;

function setupHoldButton(btnId,action){
    const btn=$(btnId);
    if(!btn)return;
    
    const path=btn.querySelector('svg.hold-progress path');
    const perimeter=384; // przybli≈ºony obw√≥d ≈õcie≈ºki
    if(path){
        path.style.strokeDasharray=perimeter;
        path.style.strokeDashoffset=perimeter;
    }
    
    const startHold=(e)=>{
        e.preventDefault();
        btn.classList.add('holding');
        
        if(path){
            path.style.strokeDashoffset=perimeter;
            holdAnimation=anime({
                targets:path,
                strokeDashoffset:[perimeter,0],
                duration:HOLD_TIME,
                easing:'linear'
            });
        }
        
        holdTimer=setTimeout(()=>{
            btn.classList.remove('holding');
            // Flash effect po zako≈Ñczeniu
            anime({
                targets:btn,
                scale:[1,1.15,1],
                duration:200,
                easing:'easeOutBack'
            });
            if(path){
                path.style.strokeDashoffset=perimeter;
            }
            action();
        },HOLD_TIME);
    };
    
    const cancelHold=()=>{
        if(holdTimer){
            clearTimeout(holdTimer);
            holdTimer=null;
        }
        if(holdAnimation){
            holdAnimation.pause();
        }
        btn.classList.remove('holding');
        if(path){
            anime({
                targets:path,
                strokeDashoffset:perimeter,
                duration:150,
                easing:'easeOutQuad'
            });
        }
    };
    
    btn.addEventListener('mousedown',startHold);
    btn.addEventListener('touchstart',startHold,{passive:false});
    btn.addEventListener('mouseup',cancelHold);
    btn.addEventListener('mouseleave',cancelHold);
    btn.addEventListener('touchend',cancelHold);
    btn.addEventListener('touchcancel',cancelHold);
}

setupHoldButton('newRoundBtn',()=>{
    if(!gameOver&&$('board').children.length)showO('newRoundConfirm');
    else initRound();
});

setupHoldButton('keyBtn',()=>{
    if(gameOver)return;
    if(!isSpymaster)showO('keyWarning');
});

// Natychmiastowe wyj≈õcie z trybu klucza
$('keyBtn').addEventListener('click',()=>{
    if(isSpymaster)toggleKey();
});

// Animowane przej≈õcia overlay
const origShowO=showO;
showO=id=>{
    const overlay=$(id);
    if(overlay){
        animateOverlayShow(overlay);
    }
    if(id==='gameSettings'){
        $('gameSoundToggle').value=cfg.sound?'true':'false';
    }
};

const origHideO=hideO;
hideO=id=>{
    const overlay=$(id);
    if(overlay && overlay.style.display!=='none'){
        animateOverlayHide(overlay);
    }
};
</script>
</body>
</html>
